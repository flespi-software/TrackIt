(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"0017":function(e,t,s){"use strict";s("1523")},"0160":function(e,t,s){},"0f97":function(e,t,s){},1523:function(e,t,s){},"1d4d":function(e,t,s){"use strict";s("d678")},"295b":function(e,t,s){"use strict";s("c487")},"43d9":function(e,t,s){},4678:function(e,t,s){var i={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df48","./fa.js":"8df48","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b46","./gd.js":"f6b46","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab4","./zh-hk.js":"49ab4","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function a(e){var t=n(e);return s(t)}function n(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=n,e.exports=a,a.id="4678"},4846:function(e,t,s){"use strict";s("0160")},"577b":function(e,t,s){"use strict";s("a436")},a436:function(e,t,s){},b656:function(e,t,s){"use strict";s("43d9")},c487:function(e,t,s){},d678:function(e,t,s){},dfed:function(e,t,s){"use strict";s("0f97")},e72c:function(e,t,s){"use strict";s("ef0a")},ef0a:function(e,t,s){},f241:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-layout",{ref:"layout",attrs:{view:"hHh LpR lFf"}},[e.isInit&&e.needShowList?s("q-drawer",{attrs:{side:"left","no-swipe-open":e.$q.platform.is.desktop,"no-swipe-close":e.$q.platform.is.desktop,breakpoint:576,behavior:"mobile"},model:{value:e.side_left,callback:function(t){e.side_left=t},expression:"side_left"}},[s("device-list",{directives:[{name:"show",rawName:"v-show",value:e.devices.length,expression:"devices.length"}],attrs:{deviceIdForWatch:e.deviceIdForWatch,activeDevicesID:e.activeDevicesID,devices:e.devices},on:{"update-watch-by-id":e.setWatchToDeviceID,"click-hide":function(t){e.side_left=!1}}})],1):e._e(),s("q-drawer",{attrs:{side:"right","no-swipe-open":"","no-swipe-close":"","content-class":{"bg-grey-9":e.telemetrySettings.inverted}},model:{value:e.side_right,callback:function(t){e.side_right=t},expression:"side_right"}},[s("div",{staticStyle:{position:"relative",height:"100vh",overflow:"hidden"}},[s("q-item",[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{color:e.telemetrySettings.inverted?"white":"",size:"1.8rem",name:"developer_board"}})],1),s("q-item-section",[s("q-item-label",{staticClass:"ellipsis text-bold q-pa-none",class:{"text-white":e.telemetrySettings.inverted},attrs:{header:""}},[e._v("Telemetry")]),e.deviceIdForTelemetry?s("q-item-label",{staticClass:"ellipsis",class:{"text-white":e.telemetrySettings.inverted},attrs:{caption:""}},[s("small",[e._v(e._s(e.deviceForTelemetry.name||"#"+e.deviceForTelemetry.id))])]):s("q-item-label",{staticClass:"ellipsis",class:{"text-white":e.telemetrySettings.inverted},attrs:{caption:""}},[s("small",[e._v("No selected device")])])],1),s("q-item-section",{attrs:{side:""}},[s("q-btn",{staticClass:"text-grey",attrs:{color:e.telemetrySettings.inverted?"white":"grey",flat:"",icon:"filter_b_and_w"},on:{click:e.telemetrySettingsChangeHandler}},[s("q-tooltip",[e._v("Inverted")])],1)],1)],1),e.deviceIdForTelemetry?s("q-item",[s("q-item-section",[s("q-input",{staticClass:"q-mb-xs",attrs:{type:"text",label:"Search",dark:e.telemetrySettings.inverted,color:e.telemetrySettings.inverted?"white":"grey",outlined:"","hide-bottom-space":""},model:{value:e.telemetrySearch,callback:function(t){e.telemetrySearch=t},expression:"telemetrySearch"}})],1)],1):e._e(),e.deviceIdForTelemetry?s("q-telemetry",{staticClass:"scroll",staticStyle:{height:"calc(100% - 128px)"},attrs:{propHistoryFlag:e.telemetryConfig.propHistoryFlag,device:e.deviceForTelemetry,inverted:e.telemetrySettings.inverted,search:e.telemetrySearch}}):s("div",{staticClass:"text-bold text-center q-mt-sm",class:{"text-white":e.telemetrySettings.inverted}},[e._v("\n        Select one by clicking on its "),s("q-icon",{attrs:{name:"mdi-car-sports",size:"1.2rem"}}),e._v(" marker\n      ")],1)],1)]),s("q-page-container",[s("q-page",[e.devices.length&&e.needShowList?s("q-btn",{staticClass:"floated menu",attrs:{small:"",round:"",flat:"",color:"bg-grey-9",size:"md"},on:{click:function(t){e.side_left=!e.side_left}}},[s("q-icon",{attrs:{name:"menu"}})],1):e._e(),s("div",{staticClass:"floated label"},[s("img",{staticStyle:{height:"40px","margin-top":"3px",display:"inline-block"},attrs:{src:"track-it-logo.png",alt:"Track it!"}}),s("div",{staticClass:"q-toolbar-title",staticStyle:{color:"rgb(51, 51, 51)",display:"inline-block"}},[e._v("\n          Track it! "),s("sup",[e._v(e._s(e.version))]),s("div",{staticClass:"q-toolbar-subtitle"},[e._v("\n            Find yourself\n          ")])])]),e.errors.length?s("q-btn",{staticClass:"floated notifications",attrs:{small:"",flat:"",round:"",color:"bg-grey-9",size:"md",icon:"notifications"},on:{click:e.clearNotificationCounter}},[e.newNotificationCounter?s("q-chip",{staticClass:"absolute-top-right q-pa-xs text-white",staticStyle:{"font-size":".6rem"},attrs:{color:"red"}},[e._v(e._s(e.newNotificationCounter))]):e._e(),s("q-menu",{ref:"popoverError",attrs:{fit:""}},[s("q-list",{staticClass:"scroll",staticStyle:{"max-height":"200px"},attrs:{"no-border":"",link:"",separator:""}},e._l(e.errors,(function(t,i){return s("q-item",{key:i,staticStyle:{cursor:"default"}},[s("q-item-section",[s("q-item-label",[e._v(e._s(t))])],1)],1)})),1)],1)],1):e._e(),e.devices.length?s("div",{staticClass:"floated date"},[s("date-range-modal",{attrs:{date:e.date,theme:e.dateTheme},on:{save:function(t){return e.date=[].concat(t)},reinit:e.initDate}})],1):e._e(),!e.activeDevicesID.length&&e.devices.length?s("div",{staticClass:"floated no-devices"},[s("span",{staticClass:"no-devices__message"},[e._v("You have no selected devices")]),s("div",{staticStyle:{"margin-top":"15px"}},[s("q-btn",{staticStyle:{"pointer-events":"auto"},attrs:{icon:"menu",color:"black",size:"md"},on:{click:function(t){e.side_left=!e.side_left}}},[e._v("\n            select devices\n          ")])],1)]):!e.devices.length&&e.hasDevicesInit?s("div",{staticClass:"floated no-devices"},[s("span",{staticClass:"no-devices__message"},[e._v("You have no devices")]),s("div",{staticClass:"q-mt-sm text-bg-grey-9",staticStyle:{"font-size":"1.3rem"}},[e._v("\n          Create one on\n          "),s("q-btn",{staticStyle:{"pointer-events":"auto"},attrs:{dense:"",color:"red-5",label:"flespi.io"},on:{click:function(t){return e.openURL("https://flespi.io")}}})],1)]):e._e(),e.$q.platform.is.desktop?s("a",{staticClass:"floated github",attrs:{href:"https://github.com/flespi-software/TrackIt/",target:"_blank"}},[s("q-btn",{attrs:{flat:"",round:"",color:"bg-grey-9"}},[s("img",{staticStyle:{height:"30px"},attrs:{src:"GitHub-Mark-32px.png",alt:"GitHub"}}),s("q-tooltip",[e._v("Show on GitHub")])],1)],1):e._e(),s("q-btn",{staticClass:"floated options",attrs:{small:"",round:"",flat:"",size:"md"}},[s("q-icon",{attrs:{color:"bg-grey-9",name:"more_vert"}}),s("q-menu",{ref:"popover-menu"},[s("q-list",{staticClass:"scroll",staticStyle:{"min-width":"200px"},attrs:{link:"",separator:""}},[s("q-item",[s("q-toggle",{attrs:{disabled:!e.devices.length,icon:"dvr",label:"Messages"},on:{input:e.menuChangeHandler},model:{value:e.params.needShowMessages,callback:function(t){e.$set(e.params,"needShowMessages",t)},expression:"params.needShowMessages"}})],1),s("q-item",[s("q-toggle",{attrs:{disable:!e.devices.length,icon:"mdi-play",label:"Player"},on:{input:e.menuChangeHandler},model:{value:e.params.needShowPlayer,callback:function(t){e.$set(e.params,"needShowPlayer",t)},expression:"params.needShowPlayer"}})],1),s("q-item",[s("q-toggle",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disabled:!e.devices.length,icon:"av_timer",label:"Telemetry"},on:{input:e.menuChangeHandler},model:{value:e.params.needShowTelemetry,callback:function(t){e.$set(e.params,"needShowTelemetry",t)},expression:"params.needShowTelemetry"}})],1),e.needHideNamesInMenu?e._e():s("q-item",[s("q-toggle",{attrs:{disabled:!e.devices.length,icon:"pin_drop",label:"Names"},on:{input:e.menuChangeHandler},model:{value:e.params.needShowNamesOnMap,callback:function(t){e.$set(e.params,"needShowNamesOnMap",t)},expression:"params.needShowNamesOnMap"}})],1),s("q-item",{staticClass:"within-iframe-hide",attrs:{clickable:""},on:{click:e.exitHandler}},[s("q-item-section",{staticClass:"q-pl-md",attrs:{avatar:""}},[s("q-icon",{attrs:{name:"exit_to_app"}})],1),s("q-item-section",[s("q-item-label",[e._v("Exit")])],1)],1)],1)],1)],1),s("map-component",{attrs:{activeDevices:e.activeDevices,deviceIdForWatch:e.deviceIdForWatch,params:e.params,date:e.date},on:{"update-telemetry-device-id":e.updateTelemetryDeviceId,"change-need-show-messages":function(t){e.params.needShowMessages=t}}})],1)],1)],1)},a=[],n=s("ded3"),r=s.n(n),o=(s("13d5"),s("2b0e")),l=s("2f62"),c=function(){var e,t,s=this,i=s.$createElement,a=s._self._c||i;return a("div",{staticClass:"q-v-date-range-picker",staticStyle:{"min-width":"180px"}},[a("q-btn",{attrs:{color:s.theme.bgColor,flat:"",dense:"",icon:"keyboard_arrow_left"},on:{click:s.prevHandler}},[a("q-tooltip",[s._v("Previous time range")])],1),a("q-btn",{staticClass:"q-pa-none",staticStyle:{"min-width":"124px","font-size":".8rem","line-height":".8rem"},attrs:{flat:"",color:s.theme.bgColor},on:{click:s.dateRangeToggle}},[a("div",[a("div",[s._v(s._s(s.formatDate(s.dateModel[0])))]),a("div",{staticStyle:{"font-size":".5rem"}},[s._v("|")]),a("div",[s._v(s._s(s.formatDate(s.dateModel[1])))])]),a("q-tooltip",[s._v("Change time")])],1),a("q-btn",{attrs:{color:s.theme.bgColor,flat:"",dense:"",icon:"keyboard_arrow_right"},on:{click:s.nextHandler}},[a("q-tooltip",[s._v("Next time range")])],1),a("q-dialog",{ref:"dateRangePickerModal",attrs:{"content-class":"modal-date-range"}},[a("q-card",[a("q-card-section",{staticClass:"scroll q-pa-none",class:(e={},e["bg-"+s.theme.bgColor]=!0,e["text-white"]=!!s.theme.bgColor,e)},[a("div",{staticClass:"flex flex-center",staticStyle:{"max-width":"330px"}},[a("div",{staticClass:"fit text-center q-my-sm"},[a("q-btn-toggle",{attrs:{options:s.dateRangeModeOptions,color:s.theme.bgColor,"text-color":"grey","toggle-text-color":s.theme.color,flat:""},model:{value:s.mode,callback:function(e){s.mode=e},expression:"mode"}})],1),a("date-range-picker",{staticClass:"q-ma-sm",attrs:{mode:s.mode,theme:s.theme},on:{"change:mode":s.changeModeDateTimeRangeHandler,error:function(e){return s.saveDisabled=e}},model:{value:s.dateModel,callback:function(e){s.dateModel=e},expression:"dateModel"}})],1)]),a("q-card-actions",{class:(t={},t["bg-"+s.theme.bgColor]=!0,t["text-white"]=!!s.theme.bgColor,t),attrs:{align:"between"}},[a("q-btn",{attrs:{flat:"",color:s.theme.color,dense:"",icon:"mdi-map-clock-outline"},on:{click:function(e){s.$emit("reinit"),s.dateRangeModalClose()}}},[a("q-tooltip",[s._v("Reinit time by devices positions")])],1),a("div",[a("q-btn",{attrs:{flat:"",color:s.theme.color},on:{click:s.dateRangeModalClose}},[s._v("close")]),a("q-btn",{attrs:{flat:"",color:s.theme.color,disable:s.saveDisabled},on:{click:s.dateRangeModalSave}},[s._v("save")])],1)],1)],1)],1)],1)},h=[],d=(s("ddb0"),s("bd4c")),m=s("a99f"),u={props:["theme","date"],data(){return{dateModel:this.date,mode:0,saveDisabled:!1,dateRangeModeOptions:[{label:"Day",value:0},{label:"Range",value:3},{label:"Manual",value:4}]}},methods:{dateRangeToggle(){this.$refs.dateRangePickerModal.toggle()},dateRangeModalClose(){this.$refs.dateRangePickerModal.hide()},changeModeDateTimeRangeHandler(e){this.mode=e},dateRangeModalSave(){let[e,t]=this.dateModel;t+=.999,this.$emit("save",[e,t]),this.dateRangeModalClose()},formatDate(e){return d["a"].formatDate(e,"DD/MM/YYYY HH:mm:ss")},prevHandler(){const e=this.dateModel[1]-this.dateModel[0],t=this.dateModel[0]-.001,s=t-e;this.dateModel=[s,t],this.$emit("save",this.dateModel)},nextHandler(){const e=this.dateModel[1]-this.dateModel[0],t=this.dateModel[1]+.001,s=t+e;this.dateModel=[t,s],this.$emit("save",this.dateModel)}},watch:{date(e){this.dateModel=e}},components:{DateRangePicker:m["a"]}},p=u,g=(s("0017"),s("2877")),v=s("9c40"),f=s("05c0"),y=s("24e8"),k=s("f09f"),b=s("a370"),_=s("6a67"),w=s("4b7e"),$=s("eebe"),D=s.n($),S=Object(g["a"])(p,c,h,!1,null,null,null),x=S.exports;D()(S,"components",{QBtn:v["a"],QTooltip:f["a"],QDialog:y["a"],QCard:k["a"],QCardSection:b["a"],QBtnToggle:_["a"],QCardActions:w["a"]});var C=s("5ee7"),M=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"map-wrapper absolute-top-left absolute-bottom-right"},[s("div",{style:{height:e.mapHeight},attrs:{id:"map"}},[s("q-resize-observer",{on:{resize:e.onResize}})],1),Object.keys(e.messages).length&&(e.params.needShowMessages||e.params.needShowPlayer)?s("queue",{ref:"queue",attrs:{devices:e.activeDevices,activeDevicesID:e.activeDevicesID,needShowMessages:e.params.needShowMessages,needShowPlayer:e.params.needShowPlayer,messages:e.allMessages,telemetryDeviceId:e.telemetryDeviceId,date:e.date,markers:e.markers,player:e.player},on:{"player-value":function(t){return e.playProcess(t,"value")},"player-play":function(t){return e.playProcess(t,"play")},"player-pause":function(t){return e.playProcess(t,"pause")},"player-stop":function(t){return e.playProcess(t,"stop")},"player-speed":e.playerSpeedChangeHandler,"player-mode":e.playerModeChange,"change-need-show-messages":function(t){e.$emit("change-need-show-messages",t)},"change-selected":function(t){e.selected=t},"update-color":e.updateColorHandler,"view-on-map":e.viewOnMapHandler}}):e._e(),s("color-modal",{ref:"colorModal",model:{value:e.color,callback:function(t){e.color=t},expression:"color"}})],1)},I=[],T=s("e11e"),q=(s("d88e"),s("6cc5"),s("7998"),s("9ae0"),s("790e"),function(e){e.Polyline.include({_snakingTimestamp:0,_snakingRings:0,_snakingTailRings:0,_snakingVertices:0,_snakingTailVertices:0,_snakingDistance:0,_snakingTailDistance:0,_snakingIn:!1,_snakingOut:!1,_snakingPaused:!1,_snakingPauseTime:0,snakeIn:function(){if(!this._snakingIn&&!this._snakingOut&&"performance"in window&&"now"in window.performance&&this._map)return this._snakingIn=!0,this._snakingTime=performance.now(),this._snakingVertices=this._snakingRings=this._snakingDistance=0,this._snakeLatLngs||(this._snakeLatLngs=e.LineUtil.isFlat(this._latlngs)?[this._latlngs]:this._latlngs),this._latlngs=[[this._snakeLatLngs[0][0],this._snakeLatLngs[0][0]]],this._update(),this._snake(),this.fire("snakestart"),this.fire("snakeInStart"),this},snakeOut:function(){if(!this._snakingOut&&"performance"in window&&"now"in window.performance&&this._map){if(this._snakingOut=!0,this._snakingTime=performance.now(),this._snakingTailVertices=this._snakingTailRings=this._snakingTailDistance=0,this._snakeLatLngs||(this._snakeLatLngs=e.LineUtil.isFlat(this._latlngs)?[this._latlngs]:this._latlngs),!this._snakingIn){const e=[],t=Object.keys(this._snakeLatLngs);t.forEach((()=>{e.push([]),this._snakeLatLngs[e.length-1].forEach((function(t){e[e.length-1].push([t.lat,t.lng])}))})),this._latlngs=e}return this._update(),this._snakingIn||this._snake(),this.fire("snakeOutStart"),this}},_snake:function(){if(!this._map)return;if(this._snakingPaused)return;const t=performance.now();let s=t-this._snakingTime;s=0===s?.001:s;const i=s*this.options.snakingSpeed/1e3;return this._snakingTime=t,this._snakingIn&&this._latlngs[this._snakingRings].pop(),this._snakingOut&&this._latlngs[this._snakingTailRings].shift(),this._snakingIn&&this._snakeHeadForward(i),this._snakingOut&&this._snakeTailForward(i),this.setLatLngs(this._latlngs),(this._snakingIn||this._snakingOut)&&(this.fire("snake"),e.Util.requestAnimFrame(this._snake,this)),this},_snakeHeadForward:function(e){let t=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingRings][this._snakingVertices]),s=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingRings][this._snakingVertices+1]),i=t.distanceTo(s);while(this._snakingDistance+e>i){if(this._snakingVertices++,this._latlngs[this._snakingRings].push(this._snakeLatLngs[this._snakingRings][this._snakingVertices]),this._snakingVertices>=this._snakeLatLngs[this._snakingRings].length-1){if(this._snakingRings>=this._snakeLatLngs.length-1)return this._snakeInEnd();this._snakingVertices=0,this._snakingRings++,this._latlngs[this._snakingRings]=[this._snakeLatLngs[this._snakingRings][this._snakingVertices]]}this._snakingDistance-=i,t=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingRings][this._snakingVertices]),s=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingRings][this._snakingVertices+1]),i=t.distanceTo(s)}this._snakingDistance+=e;const a=this._snakingDistance/i,n=s.multiplyBy(a).add(t.multiplyBy(1-a)),r=this._map.containerPointToLatLng(n);return this._latlngs[this._snakingRings].push(r),this.options.followHead&&this._map.setView(r),this},_snakeTailForward:function(e){let t=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingTailRings][this._snakingTailVertices]),s=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingTailRings][this._snakingTailVertices+1]),i=t.distanceTo(s);while(this._snakingTailDistance+e>i){if(this._snakingTailVertices++,this._latlngs[this._snakingTailRings].shift(),this._snakingTailVertices>=this._snakeLatLngs[this._snakingTailRings].length-1){if(this._snakingTailRings>=this._snakeLatLngs.length-1)return this._snakeOutEnd();this._snakingTailVertices=0,this._latlngs[this._snakingTailRings]=[],this._snakingTailRings++,this._latlngs[this._snakingTailRings].shift()}this._snakingTailDistance-=i,t=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingTailRings][this._snakingTailVertices]),s=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingTailRings][this._snakingTailVertices+1]),i=t.distanceTo(s)}this._snakingTailDistance+=e;const a=this._snakingTailDistance/i,n=s.multiplyBy(a).add(t.multiplyBy(1-a)),r=this._map.containerPointToLatLng(n);return this._latlngs[this._snakingTailRings].unshift(r),this},_snakeInEnd:function(){return this._snakingIn=!1,this._snakingOut||this.setLatLngs(this._snakeLatLngs),this.fire("snakeend"),this.fire("snakeInEnd"),this},_snakeOutEnd:function(){return this._snakingOut=!1,this.fire("snakeOutEnd"),this},snakeReset:function(){return this._snakingIn=this._snakingOut=!1,this._snakeLatLngs&&this.setLatLngs(this._snakeLatLngs),this},snakePause:function(){this._snakingPaused=!0,this._snakingPauseTime=performance.now()},snakeUnpause:function(){if(!this._snakingPaused)return;this._snakingPaused=!1;const t=performance.now(),s=t-this._snakingPauseTime;this._snakingPauseTime=0,this._snakingTime+=s,e.Util.requestAnimFrame(this._snake,this)}}),e.Polyline.mergeOptions({snakingSpeed:200,followHead:!1}),e.LayerGroup.include({_snakingLayers:[],_snakingLayersDone:0,_snakingTailLayersDone:0,_snakingIn:!1,_snakingOut:!1,_snakeTimeoutsId:[],snakeIn:function(){if("performance"in window&&"now"in window.performance&&this._map&&!this._snakingIn&&!this._snakingOut){if(this._snakingIn=!0,this._snakingLayersDone=0,0===this._snakingLayers.length&&this._initSnakingLayers(),this.options.snakeRemoveLayers)this.clearLayers();else for(const t in this._snakingLayers)this._snakingLayers[t]instanceof e.Polyline&&this.removeLayer(this._snakingLayers[t]);return this.fire("snakestart"),this.fire("snakeInStart"),this._snakeHeadNext()}},snakeOut:function(){if("performance"in window&&"now"in window.performance&&this._map&&!this._snakingOut)return this._snakingOut=!0,this._snakingTailLayersDone=0,this.fire("snakeOutStart"),this._snakeTailNext()},_initSnakingLayers:function(){const e=Object.keys(this._layers);for(const t in e){const s=e[t];this._snakingLayers.push(this._layers[s])}return this},_snakeHeadNext:function(){if(!this._snakingIn)return this;if(this._snakingLayersDone>=this._snakingLayers.length)return this.fire("snakeend"),this.fire("snakeInEnd"),void(this._snakingIn=!1);const e=this._snakingLayers[this._snakingLayersDone];return this._snakingLayersDone++,this.getLayer(e)||this.addLayer(e),"snakeIn"in e?(e.once("snakeInEnd",(function(){this._snakeTimeoutsId.push(setTimeout(this._snakeHeadNext.bind(this),this.options.snakingPause))}),this),e.snakeIn()):this._snakeTimeoutsId.push(setTimeout(this._snakeHeadNext.bind(this),this.options.snakingPause)),this.fire("snake"),this},_snakeTailNext:function(){if(!this._snakingOut)return this;if(this.options.snakeRemoveLayers&&this.removeLayer(this._snakingLayers[this._snakingTailLayersDone-1]),this._snakingTailLayersDone>=this._snakingLayers.length)return this.fire("snakeOutEnd"),void(this._snakingOut=!1);const e=this._snakingLayers[this._snakingTailLayersDone];return this._snakingTailLayersDone++,"snakeOut"in e?(e.once("snakeOutEnd",(function(){this._snakeTimeoutsId.push(setTimeout(this._snakeTailNext.bind(this),this.options.snakingPause))}),this),e.snakeOut()):this._snakeTimeoutsId.push(setTimeout(this._snakeTailNext.bind(this),this.options.snakingPause)),this.fire("snake"),this},snakeReset:function(){this._snakingIn=!1,this._snakingOut=!1,0===this._snakingLayers.length&&this._initSnakingLayers();for(const e in this._snakeTimeoutsId)clearTimeout(e);this._snakeTimeoutsId=[];for(const t in this._snakingLayers)this._snakingLayers[t]instanceof e.Polyline&&this._snakingLayers[t].snakeReset(),this.getLayer(this._snakingLayers[t])||this.addLayer(this._snakingLayers[t]);return this}}),e.LayerGroup.mergeOptions({snakingPause:200,snakeRemoveLayers:!0})}),L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"absolute-bottom-left absolute-bottom-right",attrs:{id:"queue"}},[s("q-tab-panels",{staticStyle:{background:"rgba(0, 0, 0, .5)"},attrs:{animated:""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.activeDevicesID,(function(t){return s("q-tab-panel",{key:"tab-panel-"+t,staticClass:"no-padding",attrs:{name:t.toString()}},[s("queue-item",{key:"tab-pane-"+t,attrs:{id:t,messages:e.messages[t],date:e.date,device:e.devices[t],needShowMessages:e.needShowMessages,needShowPlayer:e.needShowPlayer,player:e.player},on:{"player-value":e.playHandler,"player-play":function(t){return e.$emit("player-play",t)},"player-pause":function(t){return e.$emit("player-pause",t)},"player-stop":e.stopHandler,"player-speed":function(t){return e.$emit("player-speed",t)},"player-mode":function(t){return e.$emit("player-mode",t)},"change-need-show-messages":function(t){e.$emit("change-need-show-messages",t)},"view-on-map":function(t){e.$emit("view-on-map",t)}}})],1)})),1),e.devices.length>1?s("q-tabs",{staticClass:"bg-grey-9",attrs:{align:"left",dark:"","indicator-color":"white"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.activeDevicesID,(function(t){return s("q-tab",{key:"tab-"+t,attrs:{name:t.toString()},on:{click:function(s){e.messages[t].length&&e.markers[t]&&e.markers[t]._icon&&e.changeTabColorHandler(t)}}},[s("div",{staticClass:"text-white"},[e.messages[t].length&&e.markers[t]&&e.markers[t]._icon?s("div",{staticClass:"color-view q-mr-xs",style:{backgroundColor:e.markers[t].color},on:{click:function(s){return s.stopPropagation(),e.changeColorHandler(t)}}}):e._e(),e._v("\n        "+e._s(e.getNameById(t))+"\n      ")])])})),1):e._e(),s("color-modal",{ref:"colorModal",model:{value:e.color,callback:function(t){e.color=t},expression:"color"}})],1)},j=[],P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{style:[{height:e.height,position:"relative"}]},[e.needShowMessages?[s("div",{staticClass:"table__wrapper",style:{height:e.needShowPlayer?"calc(100% - 65px)":"100%"}},[s("messages",{staticStyle:{height:"100%"},attrs:{messages:e.messages,item:e.device,activeDeviceId:e.id,limit:0,date:e.date,activeMessagesIds:e.activeMessagesIndexes},on:{view:e.viewMessageHandler,"view-on-map":e.viewOnMapHandler}})],1)]:e._e(),e.needShowPlayer?s("div",{staticStyle:{display:"flex","background-color":"#424242"},style:{height:e.needShowMessages?"65px":"100%"}},[s("q-btn",{attrs:{icon:"dvr",color:e.needShowMessages?"blue":"white",dense:e.$q.platform.is.mobile,size:e.$q.platform.is.desktop?"1.4rem":"md",flat:""},on:{click:function(t){e.messagesFlag=!e.messagesFlag,e.$emit("change-need-show-messages",e.messagesFlag)}}},[e.$q.platform.is.desktop?s("q-tooltip",[e._v("Messages")]):e._e()],1),s("q-btn",{attrs:{icon:"time"===e.player.mode?"mdi-map-clock-outline":"mdi-map-marker-distance",disable:"play"===e.player.status,color:"white",dense:e.$q.platform.is.mobile,size:e.$q.platform.is.desktop?"1.4rem":"md",flat:""},on:{click:function(t){e.playerMode="data"===e.playerMode?"time":"data",e.$emit("player-mode",{mode:e.playerMode,id:e.id})}}},[e.$q.platform.is.desktop?s("q-tooltip",[e._v("Change mode (Time/Data)")]):e._e()],1),s("player",{ref:"player",attrs:{min:e.timeRange.min,max:e.timeRange.max,status:e.player.status,speed:e.player.speed,mode:e.player.mode},on:{"player-next":e.playerNextHandler,"player-prev":e.playerPrevHandler,"player-play":e.playerPlayHandler,"player-pause":e.playerPauseHandler,"player-stop":e.playerStopHandler,"player-speed":e.playerSpeedHandler},model:{value:e.playerValue,callback:function(t){e.playerValue=t},expression:"playerValue"}})],1):e._e()],2)},O=[],H=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("virtual-scroll-list",{ref:"scrollList",attrs:{cols:e.cols,actions:e.actions,items:e.messages,dateRange:e.dateRange,viewConfig:e.viewConfig,theme:e.theme,title:"Messages",loading:e.isLoading,autoscroll:e.needAutoscroll,scrollOffset:"10%",item:e.listItem,itemprops:e.getItemsProps},on:{"action-to-bottom":e.actionToBottomHandler,"update-cols":e.updateColsHandler,"scroll-bottom":e.scrollBottomHandler,action:e.actionHandler}},[s("div",{staticClass:"no-messages text-center",attrs:{slot:"empty"},slot:"empty"},[s("div",{staticClass:"text-white",staticStyle:{"font-size":"3rem"}},[s("div",[e._v("No messages")]),s("div",{staticStyle:{"font-size":"1.5rem"}},[e._v("or position is empty")])])])]),s("message-viewer",{ref:"messageViewer",attrs:{message:"undefined"!==typeof e.selectedMessage?e.selectedMessage:{},inverted:""},on:{close:e.closeHandler}})],1)},N=[],R=(s("26e9"),s("de45")),F=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"modal",on:{hide:function(t){return e.$emit("close")}}},[s("q-card",{class:{"bg-grey-9":void 0!==e.inverted},style:{minWidth:e.$q.platform.is.mobile?"100%":"30vw"}},[s("q-card-section",{staticClass:"scroll q-pa-none",style:{height:e.$q.platform.is.mobile?"calc(100% - 52px)":""}},[s("div",{staticClass:"layout-padding q-pa-md"},e._l(e.message,(function(t,i,a){return s("div",{key:a,staticClass:"row items-center"},[s("div",{staticClass:"text-weight-bold"},[s("span",{staticClass:"message-viewer__copy text-green cursor-pointer"},[s("q-icon",{attrs:{name:"mdi-content-copy"},nativeOn:{click:function(s){return e.copy(i+": "+t)}}})],1),s("span",{staticClass:"message-viewer__name text-white"},[e._v(e._s(i)+": ")]),s("span",{staticClass:"message-viewer__value text-green"},[e._v(e._s(e.getValue(i,t)))])])])})),0)]),s("q-separator",{attrs:{color:"white"}}),s("q-card-actions",{staticClass:"bg-grey-9 text-white",attrs:{align:"right"}},[s("q-btn",{attrs:{flat:""},on:{click:function(t){return e.copy(e.message)}}},[e._v("Copy full message")]),s("q-btn",{attrs:{flat:""},on:{click:function(t){return e.$refs.modal.hide()}}},[e._v("Close")])],1)],1)],1)},z=[],V=s("cdde"),E={name:"MessageViewer",data(){return{date:d["a"]}},props:{message:{type:Object,required:!0},inverted:{type:Boolean}},methods:{show(){this.$refs.modal.show()},getValue(e,t){return"timestamp"===e?d["a"].formatDate(1e3*t,"DD/MM/YYYY HH:mm:ss"):t},copy(e){Object(V["a"])(JSON.stringify(e)).then((e=>{this.$q.notify({color:"positive",icon:"content_copy",message:"Successfully copied",timeout:1e3})}),(e=>{this.$q.notify({color:"negative",icon:"content_copy",message:"Error coping",timeout:1e3})}))}}},B=E,Q=s("0016"),W=s("eb85"),A=Object(g["a"])(B,F,z,!1,null,null,null),Y=A.exports;D()(A,"components",{QDialog:y["a"],QCard:k["a"],QCardSection:b["a"],QIcon:Q["a"],QSeparator:W["a"],QCardActions:w["a"],QBtn:v["a"]});var U=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"cursor-pointer",class:{"missed-items":e.item["x-flespi-status"],"bg-white-opasity":e.selected,"item--telemetry-inited":e.item["x-flespi-inited-by-telemetry"]},style:{height:e.itemHeight+"px",width:e.rowWidth+"px",borderBottom:e.item.delimiter?"solid 1px #f40":"",color:e.selected?"#333":""},on:{click:function(t){return e.itemClickHandler(e.index,e.clearItem)}}},[e._l(e.cols,(function(t,i){var a,n;return["etc"===t.__dest?s("span",{key:t.name+i,staticClass:"list__item item_etc",class:(a={},a["item_"+i]=!0,a["item--active"]=e.menuCellActive&&e.menuCellActive.row===e.index&&e.menuCellActive.col===i,a)},[e._v(e._s(e.values.etc.value||"*Empty*"))]):s("span",{key:t.name+i,staticClass:"list__item",class:(n={},n["item_"+i]=!0,n["item--active"]=e.menuCellActive&&e.menuCellActive.row===e.index&&e.menuCellActive.col===i,n),attrs:{title:e.values[t.name].value}},[e._v("\n      "+e._s(e.values[t.name].value)+"\n    ")])]}))],2)},G=[],J={props:["item","index","actions","cols","itemHeight","etcVisible","rowWidth","actionsVisible","selected","menuCellActive"],data(){return{date:d["a"]}},computed:{values(){let e={};return e=this.cols.length?this.cols.reduce(((e,t,s,i)=>(e[t.name]={value:this.getValueOfProp(t,this.item)},s===i.length-1&&(e.etc={value:""}),e)),{}):{etc:{value:""}},Object.keys(this.item).forEach((t=>{if(!e[t]){if(-1!==t.indexOf("x-flespi"))return!1;-1!==t.indexOf("image.bin.")?e.etc.value+=`${t}: <binary image>`:e.etc.value+=`${t}: ${JSON.stringify(this.item[t])}; `}})),e},clearItem(){return Object.keys(this.item).reduce(((e,t)=>("uuid"===t||-1!==t.indexOf("x-flespi")||(e[t]=this.item[t]),e)),{})}},methods:{clickHandler(e,t,s){this.$emit("action",{index:e,type:t,content:s})},itemClickHandler(e,t){this.$emit("item-click",{index:e,content:t})},getValue(e){return"string"===typeof e?e:JSON.stringify(e)},getValueOfProp(e,t){const s=e.name;let i=t[s];return s.match(/timestamp$/)?i=d["a"].formatDate(1e3*i,"DD/MM/YYYY HH:mm:ss"):-1!==s.indexOf("image.bin.")?i="<binary image>":"string"!==typeof i&&(i=JSON.stringify(i)),i}}},Z=J,K=(s("1d4d"),Object(g["a"])(Z,U,G,!1,null,null,null)),X=K.exports;const ee={actions:[{icon:"mdi-eye",label:"Show message",classes:"",type:"view"}],viewConfig:{needShowFilter:!1,needShowDate:!1,needShowEtc:!0},theme:{color:"white",bgColor:"grey-9",contentInverted:!0,controlsInverted:!0}};var te={props:["mode","item","activeDeviceId","limit","messages","date","activeMessagesIds"],data(){const e=document.createElement("style");e.type="text/css";const t=document.head||document.getElementsByTagName("head")[0],s=t.appendChild(e);return{listItem:X,selectedMessage:void 0,dynamicCSS:s,theme:ee.theme,viewConfig:ee.viewConfig,actions:ee.actions,moduleName:this.activeDeviceId,autoscroll:!0}},computed:{storedMessages(){const e=this.$store.state.messages[this.moduleName].messages;return this.scrollControlling(e.length),e},cols:{get(){return this.$store.state.messages[this.moduleName].cols},set(e){this.$store.commit(`messages/${this.moduleName}/updateCols`,e)}},from:{get(){return this.$store.state.messages[this.moduleName].from},set(e){e=e||0,this.$store.commit(`messages/${this.moduleName}/setFrom`,e)}},to:{get(){return this.$store.state.messages[this.moduleName].to},set(e){e=e||0,this.$store.commit(`messages/${this.moduleName}/setTo`,e)}},dateRange(){return[this.$store.state.messages[this.moduleName].from,this.$store.state.messages[this.moduleName].to]},reverse:{get(){return this.$store.state.messages[this.moduleName].reverse||!1},set(e){this.$store.commit(`messages/${this.moduleName}/setReverse`,e)}},currentLimit:{get(){return this.$store.state.messages[this.moduleName].limit},set(e){e=e||0,this.$store.commit(`messages/${this.moduleName}/setLimit`,e)}},selected:{get(){const e=this.$store.state.messages[this.moduleName].selected,t=e.slice(-1)[0];return void 0!==t&&this.scrollToSelected(t),e},set(e){e&&e.length&&(this.autoscroll=!1),this.$store.commit(`messages/${this.moduleName}/setSelected`,e)}},realtimeEnabled(){return this.$store.state.messages[this.moduleName].realtimeEnabled},isLoading(){return this.$store.state.messages[this.moduleName].isLoading},needAutoscroll(){return this.realtimeEnabled&&!this.selected.length&&this.autoscroll}},methods:{getItemsProps(e,t){const s=this.messages[e];t.key=s["x-flespi-message-key"],t.class=[`scroll-list-item--${e}`],t.props.selected=this.selected.includes(e),t.on||(t.on={}),t.on.action=this.actionHandler,t.on["item-click"]=this.viewMessageOnMap,t.dataHandler=(e,t,s)=>(this.autoscroll=!1,this.listItem.methods.getValueOfProp(e.data,t.data))},resetParams(){this.$refs.scrollList.resetParams()},updateColsHandler(e){this.cols=e},viewMessagesHandler({index:e,content:t}){this.selectedMessage=t,this.highlightSelected([e]),this.$refs.messageViewer.show(),this.$emit("view")},viewMessageOnMap({index:e,content:t}){this.selected=[e],this.$emit("view-on-map",t)},closeHandler(){let e=[];this.selectedMessage=void 0,this.activeMessagesIds.length&&(e=[this.activeMessagesIds[this.activeMessagesIds.length-1]]),this.highlightSelected(e)},actionToBottomHandler(){this.autoscroll=!0,this.$refs.scrollList.scrollTo(this.messages.length-1)},scrollBottomHandler(){this.autoscroll=!0},copyMessageHandler({index:e,content:t}){Object(V["a"])(JSON.stringify(t)).then((e=>{this.$q.notify({color:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})}),(e=>{this.$q.notify({color:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})}))},actionHandler({index:e,type:t,content:s}){switch(t){case"view":s=Object.keys(s).reduce(((e,t)=>("uuid"===t||-1!==t.indexOf("x-flespi")||(e[t]=s[t]),e)),{}),this.viewMessagesHandler({index:e,content:s});break}},unselect(){this.selected.length&&(this.selected=[])},updateDynamicCSS(e){this.dynamicCSS.styleSheet?this.dynamicCSS.styleSheet.cssText=e:this.dynamicCSS.innerText=e},highlightSelected(e){let t,s;if(e.length){const i=e[e.length-1];s=[i],t=`.scroll-list-item--${i} {background-color: rgba(255,255,255,0.7)!important; color: #333;}`}else s=[],t="";this.selected=s,this.updateDynamicCSS(t)},scrollToSelected(e){if("number"===typeof e&&e>=0&&this.$refs.scrollList){const t=this.$refs.scrollList.itemsCount;let s=e-Math.floor(t/2);s<0&&(s=0),this.$refs.scrollList.scrollTo(s)}},messageShow(e){this.selected[0]!==e[e.length-1]&&(this.highlightSelected(e),this.scrollToSelected(e[e.length-1]))},scrollControlling(e){this.selected.length&&this.selected[0]+1e3<=e&&this.$store.dispatch(`messages/${this.moduleName}/unsubscribePooling`)}},watch:{limit(e){this.currentLimit=e},activeMessagesIds(e){this.messageShow(e)}},created(){this.currentLimit=this.limit,this.highlightSelected(this.activeMessagesIds)},destroyed(){this.$store.commit(`messages/${this.moduleName}/clearSelected`),this.dynamicCSS.parentNode.removeChild(this.dynamicCSS)},components:{VirtualScrollList:R["a"],MessageViewer:Y}},se=te,ie=(s("295b"),Object(g["a"])(se,H,N,!1,null,null,null)),ae=ie.exports,ne=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"flex","background-color":"#424242",width:"100%"}},[s("q-btn",{staticClass:"text-white",attrs:{disable:e.max<=e.min,size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""}},[e._v("\n    x"+e._s(e.currentSpeed)+"\n    "),s("q-menu",{ref:"currentSpeedPopover",staticStyle:{"background-color":"#424242"},attrs:{anchor:"top left"}},[s("div",{staticClass:"column"},[s("q-btn",{staticClass:"text-white bg-grey-9 no-border-radius full-width",attrs:{size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""},on:{click:function(t){return e.changeSpeed(100)}}},[e._v("x100")]),s("q-btn",{staticClass:"text-white bg-grey-9 no-border-radius full-width",attrs:{size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""},on:{click:function(t){return e.changeSpeed(70)}}},[e._v("x70")]),s("q-btn",{staticClass:"text-white bg-grey-9 no-border-radius full-width",attrs:{size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""},on:{click:function(t){return e.changeSpeed(50)}}},[e._v("x50")]),s("q-btn",{staticClass:"text-white bg-grey-9 no-border-radius full-width",attrs:{size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""},on:{click:function(t){return e.changeSpeed(30)}}},[e._v("x30")]),s("q-btn",{staticClass:"text-white bg-grey-9 no-border-radius full-width",attrs:{size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""},on:{click:function(t){return e.changeSpeed(10)}}},[e._v("x10")]),s("q-btn",{staticClass:"text-white bg-grey-9 no-border-radius full-width",attrs:{size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""},on:{click:function(t){return e.changeSpeed(1)}}},[e._v("x1")])],1)]),e.$q.platform.is.desktop?s("q-tooltip",[e._v("currentSpeed")]):e._e()],1),s("q-btn",{directives:[{name:"touch-hold",rawName:"v-touch-hold.noMouse",value:e.playRepeatClickHandler,expression:"playRepeatClickHandler",modifiers:{noMouse:!0}}],staticClass:"text-white",attrs:{color:"play"===e.currentStatus?"blue":"white",disable:e.max<=e.min,dense:e.$q.platform.is.mobile,size:e.$q.platform.is.desktop?"1.4rem":"md",icon:"play"===e.currentStatus?e.repeatFlag?"mdi-repeat":"mdi-pause":"mdi-play",flat:""},on:{click:[e.playClickHandler,function(t){return t.ctrlKey?e.playRepeatClickHandler.apply(null,arguments):null}]}},[e.$q.platform.is.desktop?s("q-tooltip",[e._v("Play/Pause (Ctrl+Click to repeat)")]):e._e(),e.$q.platform.is.mobile?s("q-tooltip",[e._v("Play/Pause (Touch hold to repeat)")]):e._e()],1),s("q-btn",{staticClass:"text-white",attrs:{color:"white",disable:e.max<=e.min,dense:e.$q.platform.is.mobile,size:e.$q.platform.is.desktop?"1.4rem":"md",icon:"mdi-stop",flat:""},on:{click:e.stop}},[e.$q.platform.is.desktop?s("q-tooltip",[e._v("Stop")]):e._e()],1),s("q-btn",{staticClass:"text-white",attrs:{disable:e.max<=e.min||"data"===e.mode,icon:"mdi-skip-previous",size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""},on:{click:function(t){return e.$emit("player-prev")}}},[e.$q.platform.is.desktop?s("q-tooltip",[e._v("Prev message")]):e._e()],1),s("div",{staticClass:"player"},[s("div",{staticClass:"player__main"},[s("div",{ref:"playerContainer",staticClass:"player__container",staticStyle:{transform:"translate3d(0,0,0)"}},[e.max>e.min&&"time"===e.mode?s("q-range",{attrs:{color:"white",min:e.min,max:e.max,step:1},model:{value:e.range,callback:function(t){e.range=t},expression:"range"}}):e._e(),s("div",{staticClass:"player__line cursor-pointer",class:{disabled:e.max<=e.min||"data"===e.mode},on:{click:e.clickLineHandler}},[s("div",{staticClass:"line line__disabled line__disabled--left",style:{width:100*(e.rangeMin-e.min)/(e.max-e.min)+"%"}}),s("div",{staticClass:"line line__active",style:{left:("time"===e.mode?e.current:0)+"%",width:100-("time"===e.mode?e.current:0)-100/e.max*(e.max-e.rangeMax)+"%"}}),s("div",{staticClass:"line line__disabled line__disabled--right",style:{width:100/(e.max-e.min)*(e.max-e.rangeMax)+"%"}})]),s("div",{directives:[{name:"touch-pan",rawName:"v-touch-pan.horizontal.mouse",value:e.dragPlayerControl,expression:"dragPlayerControl",modifiers:{horizontal:!0,mouse:!0}}],staticClass:"player__control cursor-pointer",class:{"player__control--mobile":e.$q.platform.is.mobile,disabled:e.max<=e.min||"data"===e.mode},style:{left:("time"===e.mode?e.current:0)+"%"}})],1)])]),s("q-btn",{staticClass:"text-white",attrs:{disable:e.max<=e.min||"data"===e.mode,icon:"mdi-skip-next",size:e.$q.platform.is.desktop?"1.4rem":"md",dense:e.$q.platform.is.mobile,flat:""},on:{click:function(t){return e.$emit("player-next")}}},[e.$q.platform.is.desktop?s("q-tooltip",[e._v("Next message")]):e._e()],1)],1)},re=[],oe=s("b047c"),le=s.n(oe),ce=s("0f32"),he=s.n(ce),de={name:"Player",props:["min","max","value","status","speed","mode"],data(){return{currentStatus:this.status,currentValue:this.value,rangeMin:this.min,rangeMax:this.max,timer:0,currentMode:this.mode,currentSpeed:this.speed,percentsByPixel:0,current:0,repeatFlag:!1}},computed:{range:{get(){return{min:this.rangeMin,max:this.rangeMax}},set(e){this.pause(),this.currentValue<=e.min&&(this.currentValue=e.min),this.currentValue>e.max&&(this.currentValue=e.max,this.end()),this.rangeMin=e.min,this.rangeMax=e.max}}},mounted(){this.$refs.playerContainer&&(this.percentsByPixel=100/this.$refs.playerContainer.offsetWidth)},watch:{currentValue:he()((function(e){this.$emit("input",Math.round(e))}),100,{trailing:!0}),currentSpeed:le()((function(e){this.$refs.currentSpeedPopover.hide(),"play"===this.currentStatus&&(this.pause(),this.$nextTick(this.play))}),100),value(e){const t=(e-this.min)/(this.max-this.min)*100;if(this.checkNeedRedraw(t),e===this.currentValue)return!1;this.currentValue=e},min(e,t){this.rangeMin===t&&(this.rangeMin=e)},max(e,t){this.rangeMax===t&&(this.rangeMax=e)},status(e,t){e!==this.currentStatus&&(this.currentStatus=e,"play"!==e&&"pause"!==e||this.playClickHandler(),"stop"===e&&this.stop())},mode(e){this.currentMode=e,this.current=0,this.currentValue=this.min,this.timer&&clearInterval(this.timer)}},methods:{checkNeedRedraw(e){Math.abs(e-this.current)>=this.percentsByPixel&&(this.current=e)},playRepeatClickHandler(){this.repeatFlag=!this.repeatFlag,"pause"===this.currentStatus&&this.playClickHandler()},playClickHandler(){switch(this.currentStatus){case"stop":case"pause":this.play();break;case"play":this.pause();break}},emit(e){status!==this.currentStatus&&this.$emit(`player-${e}`)},stop(){this.timer&&(clearInterval(this.timer),this.timer=0,"play"===this.currentStatus&&(this.currentStatus="stop",this.currentValue=this.min)),this.emit("stop")},changeCurrent(){const e=this.currentValue+1;if(e>this.rangeMax)return this.pause(),!1;this.currentValue=e},changeSpeed(e){this.currentSpeed=e,this.$emit("player-speed",e)},play(){"pause"!==this.currentStatus&&"stop"!==this.currentStatus||(this.currentStatus="play",this.emit("play")),this.currentValue===this.max&&(this.currentValue=this.min),this.timer=setInterval(this.changeCurrent,1e3/this.currentSpeed)},pause(){if(this.repeatFlag&&this.currentValue===this.max)return setTimeout((()=>{this.currentValue=this.min}),600),!1;this.timer&&(clearInterval(this.timer),this.timer=0,"play"===this.currentStatus&&(this.end(),this.currentStatus="pause",this.emit("pause")))},end(){this.value!==this.currentValue&&setTimeout((()=>{this.$emit("input",this.currentValue)}),100)},getPlayerParams(){const e=this.$refs.playerContainer,t=e.getBoundingClientRect().left,s=e.offsetWidth,i=s/(this.max-this.min);return{left:t,width:s,step:i}},dragPlayerControl(e){if(this.max<=this.min||"data"===this.mode)return!1;const{left:t,step:s}=this.getPlayerParams();let i=this.min+(e.position.left-t)/s;i<this.rangeMin&&(i=this.rangeMin),i>this.rangeMax&&(i=this.rangeMax),this.currentValue=e.isFinal?Math.round(i):i},clickLineHandler(e){if(this.max<=this.min||"data"===this.mode)return!1;const t=e.clientX,{left:s,step:i}=this.getPlayerParams(),a=this.min+(t-s)/i;if(this.currentValue!==a){if(a<this.rangeMin||a>this.rangeMax)return!1;this.currentValue=Math.round(a)}}},beforeDestroy(){this.stop()}},me=de,ue=(s("e72c"),s("4e73")),pe=s("7bbf"),ge=s("c1d0"),ve=s("f449"),fe=s("75c3"),ye=Object(g["a"])(me,ne,re,!1,null,null,null),ke=ye.exports;D()(ye,"components",{QBtn:v["a"],QMenu:ue["a"],QTooltip:f["a"],QRange:pe["a"],QSlider:ge["a"]}),D()(ye,"directives",{TouchHold:ve["a"],TouchPan:fe["a"]});var be={name:"QueueItem",props:["id","messages","date","device","needShowMessages","needShowPlayer","player"],data(){return{playerMode:this.player.mode||"time",playerValue:0,playerStatus:"stop",activeMessagesIndexes:[],messagesFlag:this.needShowMessages}},computed:{timeRange(){return this.messages.length?{min:Math.floor(this.messages[0].timestamp),max:Math.floor(this.messages[this.messages.length-1].timestamp)}:{min:0,max:0}},indexesByTimestamp(){return this.messages.reduce(((e,t,s)=>{const i=Math.floor(t.timestamp);return e[i]||(e[i]=[]),e[i].push(s),e}),{})},height(){return this.messages.length?this.needShowMessages&&!this.needShowPlayer?"20vh":!this.needShowMessages&&this.needShowPlayer?"65px":"30vh":this.needShowMessages&&this.needShowPlayer?"30vh":this.needShowMessages&&!this.needShowPlayer?"20vh":!this.needShowMessages&&this.needShowPlayer?"65px":"0vh"}},methods:{getCurrentActiveTimestamp(){let e=0;const t=Object.keys(this.indexesByTimestamp);return t.every(((t,s)=>this.playerValue>=t&&(e=t,!0))),e},update(e){"time"===this.playerMode&&(this.$emit("player-value",{id:this.id,messagesIndexes:this.indexesByTimestamp[e]}),this.activeMessagesIndexes=this.indexesByTimestamp[e]||[])},playerNextHandler(){const e=Object.keys(this.indexesByTimestamp),t=e.indexOf(this.getCurrentActiveTimestamp());if(t===e.length-1)return this.$q.notify({message:"That`s last message",color:"info",position:"bottom-left"}),!1;this.playerValue=e[t+1]},playerPrevHandler(){const e=Object.keys(this.indexesByTimestamp),t=e.indexOf(this.getCurrentActiveTimestamp());if(0===t)return this.$q.notify({message:"That`s first message",color:"info",position:"bottom-left"}),!1;this.playerValue=e[t-1]},playerPlayHandler(){this.playerStatus="play",this.playerValue||(this.playerValue=Math.floor(this.messages[0].timestamp)),this.$emit("player-play",{id:this.id})},playerPauseHandler(){this.playerStatus="pause",this.$emit("player-pause",{id:this.id})},playerStopHandler(){this.playerStatus="stop",this.messages.length?this.playerValue=Math.floor(this.messages[0].timestamp):this.playerValue=0,this.$emit("player-stop",{id:this.id})},playerSpeedHandler(e){this.$emit("player-speed",{id:this.id,speed:e})},viewMessageHandler(){this.$refs.player&&"stop"!==this.playerStatus&&this.$refs.player.stop()},viewOnMapHandler(e){this.$emit("view-on-map",e)}},watch:{playerValue(e,t){let s=0,i=!0;const a=Object.keys(this.indexesByTimestamp);a.every(((n,r)=>e>=n?(s=n,r===a.length-1&&(i=!1),!0):((t>=n||t<s)&&(i=!1),!1))),i||this.update(s)},player:{deep:!0,handler(e){this.activeMessagesIndexes&&this.activeMessagesIndexes[0]!==e.currentMsgIndex&&(this.activeMessagesIndexes=[e.currentMsgIndex])}},needShowMessages(e){this.messagesFlag=e},date(){this.playerValue=0,this.playerStatus="stop"}},components:{Messages:ae,Player:ke}},_e=be,we=Object(g["a"])(_e,P,O,!1,null,null,null),$e=we.exports;D()(we,"components",{QBtn:v["a"],QTooltip:f["a"]});var De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"colorModal",staticClass:"color-modal",attrs:{minimized:"","content-css":{minWidth:"240px",minHeight:"201px"}}},[s("div",{staticClass:"bg-grey-9"},[s("q-color",{attrs:{dark:"","format-model":"hex"},model:{value:e.color,callback:function(t){e.color=t},expression:"color"}}),s("q-btn",{staticClass:"full-width",attrs:{flat:"",color:"white"},on:{click:function(t){return e.modalSubmit(e.color)}}},[e._v("Set")])],1)])},Se=[],xe={name:"ColorModal",props:["value"],data(){return{color:this.value||"#fff"}},methods:{modalSubmit(e){this.$emit("input",e),this.currentColorId=0,this.color="#fff",this.$refs.colorModal.hide(),this.$emit("hide")},modalButtonCloseHandler(){this.color="#fff",this.$refs.colorModal.hide(),this.$emit("hide")},show(){this.$refs.colorModal.show()}},watch:{value(e){this.color=e}}},Ce=xe,Me=s("b498"),Ie=Object(g["a"])(Ce,De,Se,!1,null,"0c4b1810",null),Te=Ie.exports;D()(Ie,"components",{QDialog:y["a"],QColor:Me["a"],QBtn:v["a"]});var qe={name:"Queue",props:["messages","activeDevicesID","devices","telemetryDeviceId","date","needShowMessages","needShowPlayer","markers","player"],data(){return{selected:this.activeDevicesID.length?this.activeDevicesID[0].toString():"",telemetryOfActiveDevices:this.devices.filter((e=>this.activeDevicesID.includes(e.id))).reduce(((e,t)=>(e[t.id]=t.telemetry?t.telemetry:null,e)),{}),playerValue:0,currentColorModel:"#fff",currentColorId:0}},computed:{color:{get(){return this.currentColorModel},set(e){this.$emit("update-color",{id:this.currentColorId,color:e}),this.currentColorModel=e}}},methods:{getNameById(e){return this.devices.filter((t=>t.id===e))[0].name||`<#${e}>`},playHandler(e){this.$emit("player-value",e)},stopHandler(e){this.$emit("player-stop",e)},changeColorHandler(e){this.currentColorId=e,this.currentColorModel=this.markers[e].color,this.$refs.colorModal.show()},changeTabColorHandler(e){e.toString()===this.selected&&this.changeColorHandler(e)}},created(){this.activeDevicesID.length&&this.$emit("change-selected",parseInt(this.activeDevicesID[0]))},watch:{devices:{deep:!0,handler(e){this.telemetryOfActiveDevices=e.filter((e=>this.activeDevicesID.includes(e.id))).reduce(((e,t)=>(e[t.id]=t.telemetry?t.telemetry:null,e)),{})}},activeDevicesID(e){this.telemetryOfActiveDevices=this.devices.filter((t=>e.includes(t.id))).reduce(((e,t)=>(e[t.id]=t.telemetry?t.telemetry:null,e)),{}),e.length||(this.selected=""),this.selected&&e.includes(parseInt(this.selected))||!e.length||(this.selected=e[0].toString())},telemetryDeviceId(e){e&&(this.selected=e.toString())},selected(e){this.$emit("change-selected",parseInt(e))}},components:{QueueItem:$e,ColorModal:Te}},Le=qe,je=(s("4846"),s("adad")),Pe=s("823b"),Oe=s("429b"),He=s("7460"),Ne=Object(g["a"])(Le,L,j,!1,null,null,null),Re=Ne.exports;D()(Ne,"components",{QTabPanels:je["a"],QTabPanel:Pe["a"],QTabs:Oe["a"],QTab:He["a"],QColor:Me["a"]});var Fe=s("e24f"),ze=s("bc78");s("1732");function Ve(e,t,s){const i=`\n    <svg\n      xmlns="http://www.w3.org/2000/svg" version="1.0" width="20" height="35" viewBox="0 0 322.41 644.26"\n      preserveAspectRatio="xMidYMid meet" id="svg24">\n    <g transform="scale(.1 -.1) rotate(39.9 10895.45 -1796.96)" id="g22" style="fill:#000;stroke:none">\n      <path style="fill:${t};fill-opacity:1;stroke:none;stroke-width:7.5px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="M90.2 1440.33l700.66-772.42L1810.08 25.48l862.86 683.33 1051.22 1347.75 444.64 531.73 179-120.54 69.53 145.88-83.22 221.15 513.31 509.29 543.23 600.84 96.12 630.8-152.93 477.63-261.24 330.67-360.5 295.62-284.29 161.95-308.89 90.7-252.9 14.74-207.63-43.52-353.46-170.4-309.83-301.5-239.28-362.56-272.9-369.48-178.18-210.64-231.28 63.55-110.64-68.23-7.01-78.63 152.75-164.84-655.94-756.08-407.52-433.12-501.68-572.84-377.55-662.23-122.76-290.99z" id="path841"/><path style="fill:#000;stroke:none;stroke-width:1" d="M3746.75 5933.68c-306-61-565-242-847-592-85-106-140-197-169-281-15-42-64-108-229-306l-211-253-84 29c-46 15-100 28-120 28-55-1-115-33-143-78-24-36-47-101-47-129 0-7 41-33 91-59l91-45-19-22c-11-12-132-157-270-322-293-352-302-362-622-699-434-458-552-591-666-751-131-183-290-469-427-768-65-143-69-156-66-212 4-71 40-136 142-262 264-325 979-925 1351-1135 122-69 204-98 273-98 57 0 64 3 158 67 312 211 582 430 760 615 126 131 222 254 659 843 98 132 205 274 239 315 69 86 530 636 556 663 16 18 20 15 75-62 32-45 64-81 72-81 48 0 156 93 169 145 13 51-3 119-45 194-34 61-39 76-28 90 6 10 101 123 209 252 138 163 211 241 240 258 110 62 198 146 345 329 108 134 151 198 211 317 58 115 97 226 118 333 19 98 18 299-2 402-58 307-250 598-577 872-269 225-515 353-776 402-100 19-318 20-411 1zm415-21c297-56 614-250 910-555 107-110 158-175 224-283l41-67-39-65c-47-77-58-135-43-216 16-85 58-161 135-244l68-72-17-79c-44-220-133-392-319-623-115-143-232-256-307-295-49-26-85-64-280-296-123-145-228-272-235-280-10-12-2-33 42-114 66-118 70-153 24-196-17-16-35-29-39-29s-38 43-76 95-72 94-76 92c-10-3-559-657-671-800-57-73-209-274-337-447s-276-369-329-435c-222-279-475-505-889-794-131-92-134-93-182-89-162 16-624 337-1120 780-346 309-550 548-550 646 0 80 285 635 447 872 126 183 222 293 617 710 355 375 415 441 758 852l298 358-110 55-110 55 15 30c19 37 52 60 85 60 14 0 72-16 128-34l103-35 233 280c189 227 238 291 251 332 26 80 76 162 170 280 370 460 741 633 1180 551z" id="path4"/><path style="fill:#000;stroke:none;stroke-width:1" d="M3831.75 5895.68c-54-4-103-11-107-15-11-11 91-85 167-122 148-73 275-64 389 27l59 47-30 13c-50 20-222 51-303 55-41 2-120 0-175-5z" id="path6"/><path style="fill:#000;stroke:none;stroke-width:1" d="M4128.75 5673.68c-170-48-408-178-602-329-180-140-397-340-547-505-111-123-129-153-97-165 12-5 39 18 97 81 44 49 148 154 231 235 120 117 155 146 172 142 15-4 55 18 144 80 176 122 283 157 374 122 37-14 87-61 74-70-2-1-39-24-83-51s-189-120-322-208c-178-116-243-164-243-178 0-11 7-22 15-25 10-4 113 58 273 163 141 93 280 183 307 200 59 36 374 210 558 307 109 58 128 71 125 90-4 25-54 52-173 91-99 34-225 42-303 20zm223-56c66-17 155-51 155-59 0-4-39-28-87-53-49-25-158-84-243-131l-154-85-21 37c-28 51-73 74-142 73-86-1-142-25-291-125-193-130-200-133-82-35 189 158 404 287 600 360 82 31 190 38 265 18z" id="path8"/><path style="fill:#000;stroke:none;stroke-width:1" d="M5007.75 5219.68c-7-5-63-161-125-347-127-381-135-400-288-751-60-139-108-260-106-270s11-19 21-21c20-4 33 22 194 398 68 157 145 363 215 573l110 328 25-37c68-100 109-233 99-322-40-336-266-793-623-1260-93-121-106-152-65-152 38 0 282 338 443 612 189 322 302 641 300 846-1 91-32 185-98 294-55 91-82 121-102 109z" id="path10"/><path style="fill:#000;stroke:none;stroke-width:1" d="M2934.75 4659.68c-131-42-177-93-321-351-64-113-123-232-132-264-24-81-18-180 14-224 13-18 277-246 587-506 605-508 603-507 695-492 85 14 162 61 355 219 126 102 202 172 223 204 115 174 75 432-110 705-79 115-298 337-429 435-194 144-394 243-560 278-98 21-250 19-322-4z" id="path12"/><path style="fill:#000;stroke:none;stroke-width:1" d="M2175.75 4015.68c-254-317-401-491-606-720-310-347-397-482-410-639-4-49-1-87 12-134l18-66 104 104c523 517 976 1183 1124 1653 22 72 23 81 5 88-8 3-96-98-247-286z" id="path14"/><path style="fill:#000;stroke:none;stroke-width:1" d="M4047.75 2817.68c-352-192-817-615-1186-1079-155-194-307-412-297-422 15-15 146-11 204 6 143 42 259 151 558 531 190 240 282 350 574 684 141 162 255 300 253 305-7 21-33 15-106-25z" id="path16"/><path style="fill:#000;stroke:none;stroke-width:1" d="M1140.75 2242.68c-18-9-41-25-52-37-24-27-278-454-298-502-42-102 4-275 121-449 143-214 343-369 595-461 60-22 98-28 190-32 112-5 116-4 167 23 77 42 450 370 474 416 39 76 20 155-52 224-60 57-926 782-968 811-41 28-128 31-177 7z" id="path18"/><path style="fill:#000;stroke:none;stroke-width:1" d="M889.75 2238.68c-23-9-47-41-57-76-6-18 4-28 64-64l71-43 25 24c14 14 27 41 31 61 5 36 4 38-50 72-31 20-57 36-59 35-2 0-13-4-25-9z" id="path20"/></g>\n    </svg>\n  `,a=`\n    <div class="my-div-icon__inner">${i}</div>\n    ${s?`<div class="my-div-icon__name">${e}</div>`:""}\n  `;return a}var Ee=s("ef44");q(T);var Be={name:"Map",props:["params","deviceIdForWatch","activeDevices","delay","date"],data(){return{map:null,flyToZoom:15,markers:{},tracks:{},telemetryDeviceId:-1,activeDeviceID:0,activeDevicesID:[],selected:null,currentColorModel:"#fff",currentColorId:0,player:{currentMsgIndex:null,speed:10,status:"stop",mode:"time",tailInterval:0}}},computed:r()(r()({},Object(l["d"])({messages(e){return this.activeDevicesID.reduce(((t,s)=>(t[s]=e.messages[s].messages.reduce(((e,t,s)=>(t["position.latitude"]&&t["position.longitude"]&&(t["x-flespi-message-index"]=s,e.push(t)),e)),[]),t)),{})},allMessages(e){return this.activeDevicesID.reduce(((t,s)=>(t[s]=e.messages[s].messages,t)),{})}})),{},{color:{get(){return this.currentColorModel},set(e){this.updateColorHandler({id:this.currentColorId,color:e}),this.currentColorModel=e}},mapHeight(){let e="100%";return this.activeDevices.length?(this.params.needShowMessages&&this.params.needShowPlayer?e="calc(100% - 113px)":this.params.needShowMessages&&!this.params.needShowPlayer?e="calc(100% - 48px)":!this.params.needShowMessages&&this.params.needShowPlayer&&(e="calc(100% - 65px)"),e):e}}),methods:{initMap(){this.map||(this.map=T["map"]("map",{center:[51.50853,-.12574],zoom:3,maxBounds:[[90,-180],[-90,180]]}),this.map.addEventListener("zoom",(e=>{e.flyTo||(this.flyToZoom=e.target.getZoom())})),this.map.addEventListener("click",this.mapClickHandler),T["tileLayer"]("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:3,noWrap:!0}).addTo(this.map),T["control"].polylineMeasure({position:"topleft",showBearings:!1,clearMeasurementsOnStop:!1,showUnitControl:!1,showClearControl:!0,measureControlTitleOn:"Turn on ruler",measureControlTitleOff:"Turn off ruler",tooltipTextFinish:"Click to <b>finish line</b><br>",tooltipTextDelete:"Press SHIFT-key and click to <b>delete point</b>",tooltipTextMove:"Click and drag to <b>move point</b><br>",tooltipTextResume:"<br>Press CTRL-key and click to <b>resume line</b>",tooltipTextAdd:"Press CTRL-key and click to <b>add point</b>"}).addTo(this.map))},flyToWithHideTracks(e,t){const s=[];this.map.once("zoomstart",(e=>{Object.keys(this.tracks).forEach((e=>{const t=this.tracks[e];t instanceof T["Polyline"]&&(t.tail&&t.tail instanceof T["Polyline"]&&this.map.hasLayer(t.tail)&&(this.map.removeLayer(t.tail),s.push(t.tail)),t.overview&&t.overview instanceof T["Polyline"]&&this.map.hasLayer(t.overview)&&(this.map.removeLayer(t.overview),s.push(t.overview)),this.map.hasLayer(t.overview)&&(this.map.removeLayer(t),s.push(t)))}))})),this.map.once("zoomend",(e=>{s.forEach((e=>{this.map.addLayer(e)}))})),this.map.flyTo(e,t)},generateIcon(e,t,s){return T["divIcon"]({className:`my-div-icon icon-${e}`,iconSize:new T["Point"](20,35),html:Ve(t,s,this.params.needShowNamesOnMap)})},getColor(){const e="0123456789ABCDEF";let t=`#${e[Math.floor(5*Math.random())]}`;for(let s=0;s<5;s++)t+=e[Math.floor(15*Math.random())];return t},getColorById(e){let t=Object(Ee["a"])({store:this.$q.localStorage,storeName:this.$store.state.storeName,name:"colors"});return t||(t={}),t[e]||(t[e]=this.getColor()),Object(Ee["b"])({store:this.$q.localStorage,storeName:this.$store.state.storeName,name:"colors",value:t}),t[e]},setColorById(e,t){let s=Object(Ee["a"])({store:this.$q.localStorage,storeName:this.$store.state.storeName,name:"colors"});return s||(s={}),s[e]=t,Object(Ee["b"])({store:this.$q.localStorage,storeName:this.$store.state.storeName,name:"colors",value:s}),s[e]},getAccuracyParams(e){const t=[e["position.latitude"],e["position.longitude"]],s=e["position.hdop"]||e["position.pdop"]||0,i={stroke:!0,color:"#444",weight:3,opacity:.5,fillOpacity:.15,fillColor:"#444",clickable:!1};return{position:t,accuracy:s,circleStyle:i}},updateMarkerDirection(e,t){if(t){const s=document.querySelector(`.icon-${e} .my-div-icon__inner`);s&&(s.style.transform=`rotate(${t||0}deg)`)}},updateMarker(e,t,s){this.updateMarkerDirection(e,s),this.markers[e].setLatLng(t).update()},initMarker(e,t,s){const i=this.messages[e][this.messages[e].length-1]["position.direction"]?this.messages[e][this.messages[e].length-1]["position.direction"]:0,a=this.tracks[e]&&this.tracks[e].options?this.tracks[e].options.color:this.markers[e]?this.markers[e].color:this.getColorById(e);this.markers[e]=T["marker"](s,{icon:this.generateIcon(e,t,a),draggable:!1,title:t}),this.markers[e].id=e,this.markers[e].color=a;const{position:n,accuracy:r,circleStyle:o}=this.getAccuracyParams(this.messages[e][this.messages[e].length-1]);this.markers[e].accuracy=T["circle"](n,r,o),this.markers[e].accuracy.addTo(this.map),this.markers[e].addEventListener("add",(t=>{this.updateMarkerDirection(e,i),this.messages[e]&&this.messages[e].length&&(this.deviceIdForWatch,parseInt(e))})),this.markers[e].addEventListener("click",(t=>{this.telemetryDeviceId=parseInt(e),this.$emit("update-telemetry-device-id",this.telemetryDeviceId)})),this.markers[e].addEventListener("move",(t=>{"stop"===this.player.status&&this.updateMarkerDirection(e,this.messages[e][this.messages[e].length-1]["position.direction"])})),this.markers[e].addEventListener("contextmenu",(t=>{this.currentColorId=e,this.currentColorModel=this.markers[e].color,this.$refs.colorModal.show()})),this.markers[e].addTo(this.map)},initDeviceOnMap(e){const t=this.activeDevices.filter((t=>t.id===parseInt(e)))[0];this.markers[e]||(this.markers[e]={},this.markers[e].id=e,this.markers[e].color=this.getColorById(e),this.tracks[e]={});const s=this.messages[e]&&this.messages[e].length;if(!s)return!1;const i=[this.messages[e][this.messages[e].length-1]["position.latitude"],this.messages[e][this.messages[e].length-1]["position.longitude"]],a=t.name||`#${e}`;if(this.initMarker(e,a,i),this.tracks[e]=T["polyline"](this.getLatLngArrByDevice(e),{weight:5,color:this.markers[e].color}).addTo(this.map),this.tracks[e].addEventListener("click",(t=>this.showMessageByTrackClick(t,e,this.tracks[e]))),parseInt(e)===this.selected){const t=this.tracks[e].getBounds();this.map.fitBounds(t)}},updateDeviceOnMap(e){const t=this.getLatLngArrByDevice(e),s=this.deviceIdForWatch&&this.markers[this.deviceIdForWatch]&&this.markers[this.deviceIdForWatch]instanceof T["Marker"]?this.markers[this.deviceIdForWatch].getLatLng():{},i=this.deviceIdForWatch&&this.messages[this.deviceIdForWatch]&&this.messages[this.deviceIdForWatch].length&&s.lat&&s.lat!==this.messages[this.deviceIdForWatch][this.messages[this.deviceIdForWatch].length-1]["position.latitude"]&&s.lng&&s.lng!==this.messages[this.deviceIdForWatch][this.messages[this.deviceIdForWatch].length-1]["position.longitude"];if(i){const e=t[t.length-1];this.flyToWithHideTracks(e,this.flyToZoom)}if(!t.length)return this.removeFlags(e),this.tracks[e].tail&&this.tracks[e].tail instanceof T["Polyline"]&&this.tracks[e].tail.remove(),this.tracks[e].overview&&this.tracks[e].overview instanceof T["Polyline"]&&this.tracks[e].overview.remove(),this.markers[e].accuracy&&this.map.removeLayer(this.markers[e].accuracy),this.map.removeLayer(this.tracks[e]),this.map.removeLayer(this.markers[e]),this.tracks[e]={},this.markers[e]={color:this.markers[e].color||void 0,id:e},!1;if(!(this.markers[e]instanceof T["Marker"])){const t=this.activeDevices.filter((t=>t.id===parseInt(e)))[0].name||`#${e}`,s=[this.messages[e][this.messages[e].length-1]["position.latitude"],this.messages[e][this.messages[e].length-1]["position.longitude"]];this.initMarker(e,t,s)}if(this.tracks[e]instanceof T["Polyline"]||(this.tracks[e]=T["polyline"](this.getLatLngArrByDevice(e),{weight:4,color:this.markers[e]?this.markers[e].color:this.getColorById(e)}).addTo(this.map),this.tracks[e].addEventListener("click",(t=>this.showMessageByTrackClick(t,e,this.tracks[e])))),this.markers[e].setLatLng(t[t.length-1]).update(),this.markers[e].accuracy.setRadius(this.getAccuracyParams(this.messages[e][this.messages[e].length-1]).accuracy),this.markers[e].accuracy.setLatLng(t[t.length-1]),this.markers[e].setOpacity(1),this.tracks[e].setLatLngs(t),parseInt(e)===this.selected&&!this.$store.state.messages[e].realtimeEnabled){const t=this.tracks[e].getBounds();this.map.fitBounds(t)}},getLatLngArrByDevice(e){return this.messages[e]?this.messages[e].reduce(((e,t)=>(e.push([t["position.latitude"],t["position.longitude"]]),e)),[]):[]},onResize(){this.map&&this.map.invalidateSize()},removeMarker(e){this.markers[e]&&this.markers[e]instanceof T["Marker"]&&(this.removeFlags(e),this.map.removeLayer(this.markers[e].accuracy),this.markers[e].remove(),this.tracks[e].tail&&this.tracks[e].tail instanceof T["Polyline"]&&this.tracks[e].tail.remove(),this.tracks[e].overview&&this.tracks[e].overview instanceof T["Polyline"]&&this.tracks[e].overview.remove(),this.tracks[e].remove()),o["default"].delete(this.markers,e),o["default"].delete(this.tracks,e)},flyToDevice(e){const t=this.activeDevices.filter((t=>t.id===e)),s=t.length?t[0]:null;let i=s&&[];this.messages[e]&&this.messages[e].length&&(i=[this.messages[e][this.messages[e].length-1]["position.latitude"],this.messages[e][this.messages[e].length-1]["position.longitude"]]),i.length?this.flyToWithHideTracks(i,this.flyToZoom):this.$q.notify({message:"No Position!",color:"warning"})},centerOnDevice(e){const t=this.activeDevices.filter((t=>t.id===e)),s=t.length?t[0]:null;let i=s&&[];this.messages[e]&&this.messages[e].length&&(i=[this.messages[e][this.messages[e].length-1]["position.latitude"],this.messages[e][this.messages[e].length-1]["position.longitude"]]),i.length?this.map.setView(i,14,{animation:!1}):this.$q.notify({message:"No Position!",color:"warning"})},generateFlag(e){let{id:t,status:s}=e||{},i=t?this.getColorById(t):"#e53935",a="map-marker-star-outline";return"start"===s?(i=ze["a"].getBrand("primary"),a="map-marker-outline"):"stop"===s&&(i=ze["a"].getBrand("positive"),a="map-marker-check"),T["divIcon"]({className:`my-flag-icon flag-${s}-${t}`,iconSize:new T["Point"](35,35),html:`<i aria-hidden="true" style="color: ${i};" class="my-flag-icon__inner mdi mdi-${a}"></i>`})},addFlags(e){if(!this.markers[e])return!1;if(this.markers[e].flags||(this.markers[e].flags={start:{},stop:{}}),this.messages[e].length){const t=[this.messages[e][0]["position.latitude"],this.messages[e][0]["position.longitude"]],s=[this.messages[e][this.messages[e].length-1]["position.latitude"],this.messages[e][this.messages[e].length-1]["position.longitude"]];this.markers[e].flags.start=T["marker"](t,{icon:this.generateFlag({id:e,status:"start"})}),this.markers[e].flags.start.addTo(this.map),this.markers[e].flags.stop=T["marker"](s,{icon:this.generateFlag({id:e,status:"stop"})});const i=this.$store.state.messages[e].to<=Date.now();i&&this.markers[e].flags.stop.addTo(this.map)}},removeFlags(e){if(!this.markers[e]||!this.markers[e].flags||!(this.markers[e].flags.start instanceof T["Marker"])||!(this.markers[e].flags.stop instanceof T["Marker"]))return!1;this.markers[e].flags.start.remove(),this.markers[e].flags.stop.remove(),this.markers[e].flags=void 0},async getDeviceData(e){if(e){this.$store.state.messages[e].realtimeEnabled&&await this.$store.dispatch(`messages/${e}/unsubscribePooling`),this.$store.commit(`messages/${e}/clearMessages`);const t=this.date[0],s=this.date[1];if(this.$store.commit(`messages/${e}/setFrom`,t),this.$store.commit(`messages/${e}/setTo`,s),await this.$store.dispatch(`messages/${e}/get`),s>Date.now()){const t=await this.$store.dispatch(`messages/${e}/pollingGet`);t()}this.addFlags(e),this.$store.state.messages[e].messages.length||await this.$store.dispatch("getInitDataByDeviceId",e)}},async initDevice(e){this.$q.loading.show(),e&&(this.$store.commit(`messages/${e}/setActive`,e),await this.$store.dispatch(`messages/${e}/getCols`,{actions:!0,etc:!0}),await this.getDeviceData(e)),o["default"].connector.socket.on("offline",(()=>{this.$store.commit(`messages/${e}/setOffline`)})),o["default"].connector.socket.on("connect",(()=>{this.$store.state.messages[e].offline&&(this.$store.commit(`messages/${e}/setReconnected`),this.$store.dispatch(`messages/${e}/getMissedMessages`))})),this.needInitWatchingDevice&&e===this.deviceIdForWatch&&(this.telemetryDeviceId=parseInt(e),this.$emit("update-telemetry-device-id",this.telemetryDeviceId),this.centerOnDevice(e)),this.$q.loading.hide()},initActiveDeviceID(e){this.activeDeviceID=e||0},viewOnMapHandler(e){if(e["position.latitude"]&&e["position.longitude"]){const t=[e["position.latitude"],e["position.longitude"]],s=this.map.getZoom();this.map.messagePoint&&this.map.messagePoint.remove(),this.map.messagePoint=T["marker"](t,{icon:T["divIcon"]({className:"my-round-marker-wrapper",iconSize:new T["Point"](10,10),html:'<div class="my-round-marker"></div>'})}),this.map.messagePoint.addTo(this.map),this.flyToWithHideTracks(t,s>12?s:12)}else this.$q.notify({message:"No position",color:"warning",position:"bottom-left",icon:"mdi-alert-outline"})},playProcess(e,t){const s="data"===this.player.mode?0:1;switch(t){case"value":s?this.playerTimeValue(e):this.playerDataValue(e);break;case"play":if("play"===this.player.status)return;s?this.playerTimePlay(e):this.playerDataPlay(e);break;case"stop":if("stop"===this.player.status)return;s?this.playerTimeStop(e):this.playerDataStop(e);break;case"pause":if("pause"===this.player.status)return;s?this.playerTimePause(e):this.playerDataPause(e);break}},playerTimeValue({id:e,messagesIndexes:t}){if(!this.messages[e]||!t||"play"!==this.player.status)return!1;let s=0,i=null;const a=t[t.length-1],n=0,r=this.messages[e].slice(n,a+1),o=r.reduce(((e,t,s)=>("number"===typeof t["position.latitude"]&&"number"===typeof t["position.longitude"]&&(i=s,e.push([t["position.latitude"],t["position.longitude"]])),e)),[]);if(t.forEach((a=>{if(this.markers[e]&&this.markers[e]instanceof T["Marker"]){const n=this.messages[e][a],r=n&&"number"===typeof n["position.latitude"]&&"number"===typeof n["position.longitude"];if(this.player.currentMsgIndex=a,r){const i=[n["position.latitude"],n["position.longitude"]];if("play"===this.player.status&&0!==t[0]){let r=1e3/this.player.speed/t.length;if(0!==a){const t=this.messages[e][a-1].timestamp,i=n.timestamp,o=i-t;r=1e3*o/this.player.speed,s=o}r-=50,r?this.markers[e].slideTo(i,{duration:r}):this.markers[e].setLatLng(i).update(),this.updateMarkerDirection(e,n["position.direction"])}else this.markers[e].setLatLng(i).update(),this.updateMarker(e,i,n["position.direction"]);this.markers[e].accuracy.setRadius(this.getAccuracyParams(n).accuracy),this.markers[e].accuracy.setLatLng(i)}else{const t=this.messages[e][i],s=o[o.length-1];this.markers[e].setLatLng(s).update(),this.updateMarker(e,s,t["position.direction"]),this.markers[e].accuracy.setRadius(this.getAccuracyParams(t).accuracy),this.markers[e].accuracy.setLatLng(s)}}})),this.tracks[e]&&this.tracks[e]instanceof T["Polyline"]&&o.length){if(!this.tracks[e].tail||!(this.tracks[e].tail instanceof T["Polyline"]))return this.tracks[e].tail=T["polyline"](o,this.tracks[e].options),this.tracks[e].tail.addTo(this.map),this.tracks[e].tail.addEventListener("click",(t=>this.showMessageByTrackClick(t,e,this.tracks[e].tail))),!0;this.player.tailInterval&&clearTimeout(this.player.tailInterval),this.player.tailInterval=setTimeout((()=>{this.tracks[e].tail&&this.tracks[e].tail.setLatLngs(o)}),700*s/this.player.speed)}},playerTimePlay({id:e}){this.tracks[e].remove(),this.player.status="play"},playerTimeStop({id:e}){this.tracks[e].tail&&(this.tracks[e].tail.remove(),delete this.tracks[e].tail);const t=this.$store.state.messages[e].realtimeEnabled,s=t?this.messages[e].length-1:0,i=this.messages[e][s];this.$nextTick((()=>{this.player.currentMsgIndex=s?null:0})),this.player.status="stop",this.tracks[e].addTo(this.map);const a=[i["position.latitude"],i["position.longitude"]];this.updateMarker(e,a,i["position.direction"])},playerTimePause({id:e}){this.player.status="pause"},playerDataValue({id:e}){},playerDataPlay({id:e}){if("pause"===this.player.status)return this.tracks[e].overview.snakeUnpause(),void(this.player.status="play");this.player.status="play",this.tracks[e].remove();const t=this.messages[e].map((e=>({lat:e["position.latitude"],lng:e["position.longitude"],dir:e["position.direction"],index:e["x-flespi-message-index"]})));if(t.length<2)return this.tracks[e].addTo(this.map),this.player.status="stop",void(this.player.currentMsgIndex=null);const s=T["polyline"](t,{snakingSpeed:20*this.player.speed,color:this.tracks[e].options.color});this.tracks[e].overview=s,this.tracks[e].overview.addEventListener("click",(t=>this.showMessageByTrackClick(t,e,this.tracks[e].overview))),s.addTo(this.map).snakeIn(),s.on("snake",(()=>{const i=s.getLatLngs(),a=i.slice(-1)[0],n=a.slice(-1)[0],r=t[i[0].length-1];this.updateMarker(e,n,r.dir),this.player.currentMsgIndex!==r.index&&(this.player.currentMsgIndex=r.index)})),s.on("snakeInEnd",(()=>{this.playerDataStop({id:e})}))},playerDataStop({id:e}){this.player.status="stop",this.tracks[e].overview&&(this.tracks[e].overview.remove(),delete this.tracks[e].overview),this.tracks[e]&&this.tracks[e]instanceof T["Polyline"]&&(this.tracks[e].addTo(this.map),this.tracks[e].addEventListener("click",(t=>this.showMessageByTrackClick(t,e,this.tracks[e]))));const t=this.messages[e].slice(-1)[0];if(this.player.currentMsgIndex=null,t){const s=[t["position.latitude"],t["position.longitude"]];this.updateMarker(e,s,t["position.direction"])}},playerDataPause({id:e}){"stop"!==this.player.status&&(this.player.status="pause",this.tracks[e].overview.snakePause())},playerSpeedChangeHandler({speed:e,id:t}){this.player.speed=e,"data"===this.player.mode&&"stop"!==this.player.status&&this.tracks[t].overview.setStyle({snakingSpeed:20*e})},playerModeChange({id:e,mode:t}){"stop"!==this.player.status&&("data"===t?this.playerTimeStop({id:e}):this.playerDataStop({id:e})),this.player.mode=t},updateColorHandler({id:e,color:t}){this.tracks[e].setStyle({color:t}),this.tracks[e].tail&&this.tracks[e].tail.setStyle({color:t}),this.tracks[e].overview&&this.tracks[e].overview.setStyle({color:t}),this.markers[e].color=t,this.markers[e].setIcon(this.generateIcon(e,this.markers[e].options.title,t)),this.setColorById(e,t)},registerModule(e){this.$store.registerModule(["messages",e],Object(Fe["a"])({Vue:o["default"],LocalStorage:this.$q.localStorage,name:{name:"messages",lsNamespace:`${this.$store.state.storeName}.cols`},errorHandler:e=>{this.$store.commit("reqFailed",e)}}))},showMessageByTrackClick(e,t,s){e.originalEvent.view.L.DomEvent.stopPropagation(e);const i=this.messages[t],a=T["GeometryUtil"].closest(this.map,s,e.latlng),n=i.reduce(((e,t,s)=>{const n=t["position.latitude"],r=t["position.longitude"],o=i[s+1];if(!o)return e;const l=o["position.latitude"],c=o["position.longitude"],h=n>=a.lat&&l<=a.lat||n<=a.lat&&l>=a.lat,d=r>=a.lng&&c<=a.lng||r<=a.lng&&c>=a.lng;if(h&&d){const t=T["GeometryUtil"].distance(this.map,a,{lat:n,lng:r}),i=T["GeometryUtil"].distance(this.map,a,{lat:l,lng:c}),o=t>i?s+1:s;e.push(o)}return e}),[]),r=i[n.slice(-1)[0]]||{};this.viewOnMapHandler(r),this.$store.commit(`messages/${t}/setSelected`,n)},mapClickHandler(e){this.map.messagePoint&&this.map.messagePoint.remove(),this.activeDevicesID.forEach((e=>{this.$store.commit(`messages/${e}/clearSelected`)}))}},watch:{messages:{deep:!0,handler(e){if("play"===this.player.status||"pause"===this.player.status)return!1;const t=Object.keys(e),s=Object.keys(this.markers);if(!t.length)return Object.keys(this.markers).forEach((e=>{this.removeMarker(e)})),!1;if(t.length<s.length){const e=s.filter((e=>!t.includes(e)))[0];return this.removeMarker(e),!1}t.forEach((t=>{if(!e[t].length)return this.activeDevices.filter((e=>e.id===parseInt(t)))[0].telemetry||this.markers[t]?this.updateDeviceOnMap(t):this.initDeviceOnMap(t),!1;s.includes(t)?this.updateDeviceOnMap(t):this.initDeviceOnMap(t)}))}},activeDevices(e){const t=e.map((e=>e.id));this.activeDeviceID||t.forEach((e=>{this.initActiveDeviceID(e)}));const s=Object.keys(this.messages).map((e=>parseInt(e))),i=s.length>t.length?"remove":"add";switch(t.forEach((e=>{this.$store.state.messages[e]||(this.registerModule(e),this.$store.commit(`messages/${e}/setSortBy`,"timestamp"),this.$store.commit(`messages/${e}/setLimit`,0))})),this.activeDevicesID=t,i){case"remove":{const e=s.filter((e=>!t.includes(e)));1===e.length&&e[0]?this.$store.commit(`messages/${e[0]}/clear`):e.length===s.length&&e.forEach((e=>{this.$store.commit(`messages/${e}/clear`)}));break}case"add":{const e=t.filter((e=>!s.includes(e)));e&&e.forEach((e=>{this.initDevice(e)}));break}}this.map&&T["DomUtil"].hasClass(this.map._container,"crosshair-cursor-enabled")&&T["DomUtil"].removeClass(this.map._container,"crosshair-cursor-enabled")},deviceIdForWatch(e){e&&this.flyToDevice(e)},"params.needShowNamesOnMap":function(e){Object.keys(this.markers).forEach((e=>{const t=this.activeDevices.filter((t=>t.id===parseInt(e)))[0],s=this.messages[e]&&this.messages[e].length?[this.messages[e][this.messages[e].length-1]["position.latitude"],this.messages[e][this.messages[e].length-1]["position.longitude"]]:[],i=t.name||`#${e}`;this.markers[e]instanceof T["Marker"]&&(this.markers[e].remove(),this.map.removeLayer(this.markers[e].accuracy),this.initMarker(e,i,s))}))},date(e,t){t&&(this.player.status="stop",this.player.currentMsgIndex=null,this.activeDevicesID.forEach((async e=>{await this.getDeviceData(e)})))},selected(e){if(this.tracks[e]&&this.tracks[e]instanceof T["Polyline"]){const t=this.tracks[e].getBounds();this.map.fitBounds(t)}}},created(){this.deviceIdForWatch&&(this.needInitWatchingDevice=!0),this.activeDevicesID=this.activeDevices.map((e=>e.id)),this.activeDevicesID.forEach((e=>{this.registerModule(e),this.$store.commit(`messages/${e}/setSortBy`,"timestamp"),this.initDevice(e)})),o["default"].connector.socket.on("offline",(()=>{this.$store.commit("setSocketOffline",!0)})),o["default"].connector.socket.on("connect",(()=>{this.$store.commit("setSocketOffline",!1)}))},destroyed(){o["default"].connector.socket.off("offline"),o["default"].connector.socket.off("connect"),this.activeDevicesID.forEach((async e=>{this.$store.unregisterModule(["messages",e])}))},mounted(){this.initMap()},components:{Queue:Re,ColorModal:Te}},Qe=Be,We=(s("577b"),s("3980")),Ae=Object(g["a"])(Qe,M,I,!1,null,null,null),Ye=Ae.exports;D()(Ae,"components",{QResizeObserver:We["a"]});var Ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-list",{staticClass:"bg-grey-9 text-white",attrs:{separator:""}},[s("q-item-label",{ref:"header",staticStyle:{height:"138px","line-height":"58px!important"}},[s("big",[s("q-icon",{staticClass:"cursor-pointer",staticStyle:{"margin-right":"15px"},attrs:{name:"mdi-arrow-left",size:"1.8rem"},nativeOn:{click:function(t){return e.$emit("click-hide")}}}),e._v("\n      Devices\n    ")],1),s("div",{staticClass:"q-px-sm"},[s("q-input",{attrs:{dark:"",color:"white",outlined:"",label:"Filter","hide-bottom-space":""},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})],1)],1),s("VirtualList",{style:{height:e.height+"px"},attrs:{size:68,remain:e.itemsCount}},e._l(e.filteredDevices,(function(t){return s("device",{key:t.id,attrs:{device:t,activeDevicesID:e.activeDevicesID,isDeviceWatched:e.deviceIdForWatch===t.id},on:{"update-watch-by-id":e.setWatchByDeviceID}})})),1)],1)},Ge=[],Je=(s("4e82"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-item",{class:[e.model?"device-item__active":"",e.device.messages_ttl?"":"disabled"],attrs:{highlight:e.$q.platform.is.desktop,clickable:""},on:{click:e.deviceClickHandler}},[e.device.messages_ttl?e._e():s("q-tooltip",[e._v("You should set messages ttl more than 0")]),s("q-item-section",{staticClass:"flex flex-center",class:[e.model?"text-green-2":""],attrs:{avatar:""}},[s("q-icon",{attrs:{name:"developer_board"}}),s("small",[e._v("#"+e._s(e.device.id))])],1),s("q-item-section",[s("q-item-label",{staticClass:"ellipsis q-pa-none text-white",attrs:{header:""}},[e._v(e._s(e.device.name||"<noname>"))]),s("q-item-label",{staticClass:"ellipsis text-grey-3 full-width",attrs:{caption:""}},[s("q-icon",{attrs:{name:"label_outline"}}),e._v(" "+e._s(e.device.configuration&&e.device.configuration.ident?e.device.configuration.ident:"<no ident>"))],1),s("q-item-label",{staticClass:"text-grey-3",attrs:{caption:""}},[s("q-icon",{attrs:{name:"phone"}}),e._v(" "+e._s(e.device.configuration&&e.device.configuration.phone?e.device.configuration.phone:"<no phone>"))],1)],1),s("q-item-section",{staticClass:"text-center",attrs:{side:""}},[s("q-item-label",[s("q-icon",{class:[e.isDeviceWatched&&e.activeDevicesID.includes(e.device.id)?"icon__send-active":"text-grey-5"],attrs:{size:"1.5rem",name:"gps_fixed"},nativeOn:{click:function(t){return t.stopPropagation(),e.watchDeviceHandler.apply(null,arguments)}}},[e.device.messages_ttl?s("q-tooltip",{model:{value:e.watchTooltip,callback:function(t){e.watchTooltip=t},expression:"watchTooltip"}},[e._v("Show on map")]):e._e()],1)],1)],1)],1)}),Ze=[],Ke={props:["device","activeDevicesID","isDeviceWatched"],data(){return{watchTooltip:!1}},computed:{model(){return this.activeDevicesID.includes(this.device.id)}},methods:{deviceClickHandler(){this.activeDevicesID.includes(this.device.id)?this.unsetActiveDevice():this.setActiveDevice()},setActiveDevice(){this.device.messages_ttl&&this.$store.commit("setActiveDevice",this.device.id)},unsetActiveDevice(){this.$store.commit("unsetActiveDevice",this.device.id)},watchDeviceHandler(){if(!this.device.messages_ttl)return!1;this.activeDevicesID.includes(this.device.id)||this.setActiveDevice(),setTimeout((()=>{this.isDeviceWatched?this.$emit("update-watch-by-id",null):this.$emit("update-watch-by-id",this.device.id)}),500),setTimeout((()=>{this.watchTooltip=!1}),500)}}},Xe=Ke,et=(s("dfed"),s("66e5")),tt=s("4074"),st=s("0170"),it=Object(g["a"])(Xe,Je,Ze,!1,null,null,null),at=it.exports;D()(it,"components",{QItem:et["a"],QTooltip:f["a"],QItemSection:tt["a"],QIcon:Q["a"],QItemLabel:st["a"]});var nt=s("89c1"),rt=s.n(nt),ot={name:"DeviceList",data(){return{unsubscribeDevices:()=>{},itemsCount:0,height:0,filter:""}},props:["devices","activeDevicesID","deviceIdForWatch"],components:{Device:at,VirtualList:rt.a},computed:{filteredDevices(){const e=this.filter.toLowerCase(),t=this.filter?this.devices.filter((t=>t&&"undefined"!==typeof t.name&&null!==t.name&&t.name.toLowerCase().indexOf(e)>=0||t&&"undefined"!==typeof t.id&&null!==t.id&&(t.id+"").indexOf(e)>=0||t&&t.configuration&&"undefined"!==typeof t.configuration.ident&&null!==t.configuration.ident&&t.configuration.ident.toLowerCase().indexOf(e)>=0)):this.devices;return t.sort(((e,t)=>{if(!e.name)return-1;if(!t.name)return 1;const s=e.name.toLowerCase(),i=t.name.toLowerCase();return s<i?-1:1})),t}},methods:{setWatchByDeviceID(e){this.$emit("update-watch-by-id",e)},onResize(e){this.height=e-138,this.itemsCount=Math.ceil((e-138)/68)}},watch:{"$q.screen.height":{immediate:!0,handler(e){this.onResize(e)}}}},lt=ot,ct=s("1c1c"),ht=s("27f9"),dt=Object(g["a"])(lt,Ue,Ge,!1,null,null,null),mt=dt.exports;D()(dt,"components",{QList:ct["a"],QItemLabel:st["a"],QIcon:Q["a"],QInput:ht["a"]});var ut=s("9224"),pt=s("b06b"),gt={data(){return{deviceIdForWatch:null,deviceIdForTelemetry:null,needShowList:!0,needHideNamesInMenu:!1,params:{needShowMessages:!1,needShowTelemetry:!1,needShowNamesOnMap:!0,needShowPlayer:!0},side_left:!1,side_right:!1,telemetrySettings:{inverted:!0},telemetrySearch:"",telemetryConfig:{propHistoryFlag:!0},version:ut.version,dateTheme:{color:"white",bgColor:"grey-9",modeSwitch:!1},isInit:o["default"].connector.socket.connected(),unsubscribeDevices:()=>{}}},computed:r()(r()({},Object(l["d"])({token:e=>e.token,devices:e=>e.devices,isLoading:e=>e.isLoading,activeDevicesID(e){return e.activeDevicesID},hasDevicesInit:e=>e.hasDevicesInit,activeDevices:e=>e.devices.filter((t=>e.activeDevicesID.includes(t.id))),lastActiveDevicesUpdate(e){return this.activeDevicesID.reduce(((t,s)=>{const i=e.messages[s].messages.filter((e=>!!e["position.latitude"]&&!!e["position.longitude"]));return i.length?t[s]=Math.floor(1e3*i[i.length-1].timestamp):t[s]=0,t}),{})},errors:e=>e.errors,newNotificationCounter:e=>e.newNotificationCounter,deviceForTelemetry(e){return this.deviceIdForTelemetry?e.devices.filter((e=>e.id===this.deviceIdForTelemetry))[0]:{}}})),{},{date:{get(){return this.$store.state.date},set(e){this.$store.commit("setDate",e)}}}),components:{DeviceList:mt,MapComponent:Ye,QTelemetry:C["a"],DateRangeModal:x},methods:r()(r()(r()({openURL:pt["a"]},Object(l["c"])(["clearToken","clearCurrentRegion","setDevicesInit","unsetDevicesInit","setActiveDevice","reqFailed","clearNotificationCounter","clearErrors"])),Object(l["b"])(["getLastUpdatePosition","poolDevices"])),{},{exitHandler(e){o["default"].connector.socket.off("error"),this.unsetDevicesInit(),this.clearToken(),this.clearCurrentRegion(),this.$router.push("/login")},setWatchToDeviceID(e){this.updateTelemetryDeviceId(e),this.deviceIdForWatch=e},menuChangeHandler(e){Object(Ee["b"])({store:this.$q.localStorage,storeName:this.$store.state.storeName,name:"params",value:this.params})},telemetrySettingsChangeHandler(){this.$set(this.telemetrySettings,"inverted",!this.telemetrySettings.inverted),Object(Ee["b"])({store:this.$q.localStorage,storeName:this.$store.state.storeName,name:"telemertySettings",value:this.telemetrySettings})},updateTelemetryDeviceId(e){if(this.deviceIdForTelemetry===e)return this.setWatchToDeviceID(null),!1;const t=this.devices.filter((t=>t.id===e));t.length?(this.deviceIdForTelemetry=e,this.deviceIdForWatch=e,this.params.needShowTelemetry&&this.deviceIdForTelemetry&&this.activeDevicesID.includes(this.deviceIdForTelemetry)&&setTimeout((()=>{if(e===this.deviceIdForWatch&&this.$q.platform.is.mobile)return!1}),0)):this.deviceIdForTelemetry=null},formatDate(e){return d["a"].formatDate(e,"DD/MM/YYYY")},paramsProcess(){const e=Object(Ee["a"])({store:this.$q.localStorage,storeName:this.$store.state.storeName,name:"params"});e&&(this.$set(this,"params",Object.assign(this.params,e)),this.side_right=e.needShowTelemetry);const t=Object(Ee["a"])({store:this.$q.localStorage,storeName:this.$store.state.storeName,name:"telemetrySettings"});t&&this.$set(this,"telemetrySettings",Object.assign(this.telemetrySettings,t))},connectProcess(){this.isInit||(o["default"].connector.socket.on("connect",(()=>{this.isInit=!0,this.$q.loading.hide()})),this.$q.loading.show())},initDate(){this.getLastUpdatePosition().then((e=>{this.date=e}))},routeProcess(){const e=this.$route.query.from,t=this.$route.query.to,s=this.$route.query.hidelist||Object(Ee["a"])({store:this.$q.sessionStorage,storeName:this.$store.state.storeName,name:"hidelist"}),i=this.$route.query.names||Object(Ee["a"])({store:this.$q.sessionStorage,storeName:this.$store.state.storeName,name:"names"}),a=this.$route.params.devices;if(e&&t?this.date=[1e3*e,1e3*t]:this.date[0]||this.date[1]||this.initDate(),s&&(Object(Ee["b"])({store:this.$q.sessionStorage,storeName:this.$store.state.storeName,name:"hidelist",value:s}),this.needShowList=!1),i&&(this.needHideNamesInMenu=!0,Object(Ee["b"])({store:this.$q.sessionStorage,storeName:this.$store.state.storeName,name:"names",value:i}),"true"===i?this.$set(this.params,"needShowNamesOnMap",!0):"false"===i&&this.$set(this.params,"needShowNamesOnMap",!1),this.menuChangeHandler()),a){const e=a.split(",").map((e=>+e));e.forEach((e=>{this.setActiveDevice(e)}))}},loginProcess(){this.$route.params.token?this.$router.push(`/login/${this.$route.params.token}`):this.$router.push("/login")}}),watch:{token(e){e||this.$router.push("/login")},hasDevicesInit(e){e?this.$q.loading.hide():this.$q.loading.show()},deviceIdForWatch(e){e&&(this.side_left=!1)},devices(e,t){e.length||(this.side_left=!1,this.side_right=!1)},"params.needShowTelemetry":function(e){this.side_right=e}},created(){if(this.$store.state.telemetry||this.$store.registerModule("telemetry",Object(C["b"])(this.$store,o["default"])),this.clearNotificationCounter(),this.clearErrors(),this.routeProcess(),!this.token)return this.loginProcess(),!1;this.connectProcess(),this.poolDevices().then((e=>{this.unsubscribeDevices=e})),this.activeDevicesID.length&&(this.$router.push(`/devices/${this.activeDevicesID.join(",")}`),1===this.activeDevicesID.length&&(this.deviceIdForWatch=this.activeDevicesID[0])),this.paramsProcess()},destroyed(){this.unsubscribeDevices&&this.unsubscribeDevices(),o["default"].connector.socket.off("connect")}},vt=gt,ft=(s("b656"),s("4d5a")),yt=s("9404"),kt=s("09e3"),bt=s("9989"),_t=s("6ac5"),wt=s("65c6"),$t=s("b047"),Dt=s("9564"),St=s("7f67"),xt=Object(g["a"])(vt,i,a,!1,null,null,null);t["default"]=xt.exports;D()(xt,"components",{QLayout:ft["a"],QDrawer:yt["a"],QItem:et["a"],QItemSection:tt["a"],QIcon:Q["a"],QItemLabel:st["a"],QBtn:v["a"],QTooltip:f["a"],QInput:ht["a"],QPageContainer:kt["a"],QPage:bt["a"],QToolbarTitle:_t["a"],QToolbar:wt["a"],QChip:$t["a"],QMenu:ue["a"],QList:ct["a"],QToggle:Dt["a"],QDialog:y["a"]}),D()(xt,"directives",{ClosePopup:St["a"]})}}]);